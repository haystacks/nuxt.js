{"version":3,"file":"nuxt.js","sources":["../lib/common/utils.js","../lib/common/options.js","../lib/core/module.js","../lib/core/meta.js","../lib/core/renderer.js","../lib/core/nuxt.js","../lib/builder/webpack/timefix-plugin.js","../lib/builder/webpack/base.config.js","../lib/builder/webpack/client.config.js","../lib/builder/webpack/server.config.js","../lib/builder/webpack/dll.config.js","../lib/builder/webpack/vue-loader.config.js","../lib/builder/webpack/style-loader.js","../lib/builder/builder.js","../lib/builder/generator.js","../lib/index.js"],"sourcesContent":["import { resolve, relative, sep } from 'path'\r\nimport _ from 'lodash'\r\n\r\nexport function encodeHtml(str) {\r\n  return str.replace(/</g, '&lt;').replace(/>/g, '&gt;')\r\n}\r\n\r\nexport function getContext(req, res) {\r\n  return { req, res }\r\n}\r\n\r\nexport function setAnsiColors(ansiHTML) {\r\n  ansiHTML.setColors({\r\n    reset: ['efefef', 'a6004c'],\r\n    darkgrey: '5a012b',\r\n    yellow: 'ffab07',\r\n    green: 'aeefba',\r\n    magenta: 'ff84bf',\r\n    blue: '3505a0',\r\n    cyan: '56eaec',\r\n    red: '4e053a'\r\n  })\r\n}\r\n\r\nexport async function waitFor(ms) {\r\n  return new Promise(function (resolve) {\r\n    setTimeout(resolve, (ms || 0))\r\n  })\r\n}\r\n\r\nexport function urlJoin() {\r\n  return [].slice.call(arguments).join('/').replace(/\\/+/g, '/').replace(':/', '://')\r\n}\r\n\r\nexport function isUrl(url) {\r\n  return (url.indexOf('http') === 0 || url.indexOf('//') === 0)\r\n}\r\n\r\nexport function promisifyRoute(fn) {\r\n  // If routes is an array\r\n  if (Array.isArray(fn)) {\r\n    return Promise.resolve(fn)\r\n  }\r\n  // If routes is a function expecting a callback\r\n  if (fn.length === 1) {\r\n    return new Promise((resolve, reject) => {\r\n      fn(function (err, routeParams) {\r\n        if (err) {\r\n          reject(err)\r\n        }\r\n        resolve(routeParams)\r\n      })\r\n    })\r\n  }\r\n  let promise = fn()\r\n  if (!promise || (!(promise instanceof Promise) && (typeof promise.then !== 'function'))) {\r\n    promise = Promise.resolve(promise)\r\n  }\r\n  return promise\r\n}\r\n\r\nexport function sequence(tasks, fn) {\r\n  return tasks.reduce((promise, task) => promise.then(() => fn(task)), Promise.resolve())\r\n}\r\n\r\nexport function parallel(tasks, fn) {\r\n  return Promise.all(tasks.map(task => fn(task)))\r\n}\r\n\r\nexport function chainFn(base, fn) {\r\n  /* istanbul ignore if */\r\n  if (!(fn instanceof Function)) {\r\n    return\r\n  }\r\n  return function () {\r\n    if (typeof base !== 'function') {\r\n      return fn.apply(this, arguments)\r\n    }\r\n    let baseResult = base.apply(this, arguments)\r\n    // Allow function to mutate the first argument instead of returning the result\r\n    if (baseResult === undefined) {\r\n      baseResult = arguments[0]\r\n    }\r\n    let fnResult = fn.call(this, baseResult, ...Array.prototype.slice.call(arguments, 1))\r\n    // Return mutated argument if no result was returned\r\n    if (fnResult === undefined) {\r\n      return baseResult\r\n    }\r\n    return fnResult\r\n  }\r\n}\r\n\r\nexport function isPureObject(o) {\r\n  return !Array.isArray(o) && typeof o === 'object'\r\n}\r\n\r\nexport const isWindows = /^win/.test(process.platform)\r\n\r\nexport function wp(p = '') {\r\n  /* istanbul ignore if */\r\n  if (isWindows) {\r\n    return p.replace(/\\\\/g, '\\\\\\\\')\r\n  }\r\n  return p\r\n}\r\n\r\nexport function wChunk(p = '') {\r\n  /* istanbul ignore if */\r\n  if (isWindows) {\r\n    return p.replace(/\\//g, '\\\\\\\\')\r\n  }\r\n  return p\r\n}\r\n\r\nconst reqSep = /\\//g\r\nconst sysSep = _.escapeRegExp(sep)\r\nconst normalize = string => string.replace(reqSep, sysSep)\r\n\r\nexport function r() {\r\n  let args = Array.prototype.slice.apply(arguments)\r\n  let lastArg = _.last(args)\r\n\r\n  if (lastArg.includes('@') || lastArg.includes('~')) {\r\n    return wp(lastArg)\r\n  }\r\n\r\n  return wp(resolve(...args.map(normalize)))\r\n}\r\n\r\nexport function relativeTo() {\r\n  let args = Array.prototype.slice.apply(arguments)\r\n  let dir = args.shift()\r\n\r\n  // Resolve path\r\n  let path = r(...args)\r\n\r\n  // Check if path is an alias\r\n  if (path.includes('@') || path.includes('~')) {\r\n    return path\r\n  }\r\n\r\n  // Make correct relative path\r\n  let rp = relative(dir, path)\r\n  if (rp[0] !== '.') {\r\n    rp = './' + rp\r\n  }\r\n  return wp(rp)\r\n}\r\n\r\nexport function flatRoutes(router, path = '', routes = []) {\r\n  router.forEach((r) => {\r\n    if (!r.path.includes(':') && !r.path.includes('*')) {\r\n      /* istanbul ignore if */\r\n      if (r.children) {\r\n        flatRoutes(r.children, path + r.path + '/', routes)\r\n      } else {\r\n        routes.push((r.path === '' && path[path.length - 1] === '/' ? path.slice(0, -1) : path) + r.path)\r\n      }\r\n    }\r\n  })\r\n  return routes\r\n}\r\n\r\nexport function cleanChildrenRoutes(routes, isChild = false) {\r\n  let start = -1\r\n  let routesIndex = []\r\n  routes.forEach((route) => {\r\n    if (/-index$/.test(route.name) || route.name === 'index') {\r\n      // Save indexOf 'index' key in name\r\n      let res = route.name.split('-')\r\n      let s = res.indexOf('index')\r\n      start = (start === -1 || s < start) ? s : start\r\n      routesIndex.push(res)\r\n    }\r\n  })\r\n  routes.forEach((route) => {\r\n    route.path = (isChild) ? route.path.replace('/', '') : route.path\r\n    if (route.path.indexOf('?') > -1) {\r\n      let names = route.name.split('-')\r\n      let paths = route.path.split('/')\r\n      if (!isChild) {\r\n        paths.shift()\r\n      } // clean first / for parents\r\n      routesIndex.forEach((r) => {\r\n        let i = r.indexOf('index') - start //  children names\r\n        if (i < paths.length) {\r\n          for (let a = 0; a <= i; a++) {\r\n            if (a === i) {\r\n              paths[a] = paths[a].replace('?', '')\r\n            }\r\n            if (a < i && names[a] !== r[a]) {\r\n              break\r\n            }\r\n          }\r\n        }\r\n      })\r\n      route.path = (isChild ? '' : '/') + paths.join('/')\r\n    }\r\n    route.name = route.name.replace(/-index$/, '')\r\n    if (route.children) {\r\n      if (route.children.find((child) => child.path === '')) {\r\n        delete route.name\r\n      }\r\n      route.children = cleanChildrenRoutes(route.children, true)\r\n    }\r\n  })\r\n  return routes\r\n}\r\n\r\nexport function createRoutes(files, srcDir) {\r\n  let routes = []\r\n  files.forEach((file) => {\r\n    let keys = file.replace(/^pages/, '').replace(/\\.vue$/, '').replace(/\\/{2,}/g, '/').split('/').slice(1)\r\n    let route = { name: '', path: '', component: r(srcDir, file) }\r\n    let parent = routes\r\n    keys.forEach((key, i) => {\r\n      route.name = route.name ? route.name + '-' + key.replace('_', '') : key.replace('_', '')\r\n      route.name += (key === '_') ? 'all' : ''\r\n      route.chunkName = file.replace(/\\.vue$/, '')\r\n      let child = _.find(parent, { name: route.name })\r\n      if (child) {\r\n        child.children = child.children || []\r\n        parent = child.children\r\n        route.path = ''\r\n      } else {\r\n        if (key === 'index' && (i + 1) === keys.length) {\r\n          route.path += (i > 0 ? '' : '/')\r\n        } else {\r\n          route.path += '/' + (key === '_' ? '*' : key.replace('_', ':'))\r\n          if (key !== '_' && key.indexOf('_') !== -1) {\r\n            route.path += '?'\r\n          }\r\n        }\r\n      }\r\n    })\r\n    // Order Routes path\r\n    parent.push(route)\r\n    parent.sort((a, b) => {\r\n      if (!a.path.length || a.path === '/') {\r\n        return -1\r\n      }\r\n      if (!b.path.length || b.path === '/') {\r\n        return 1\r\n      }\r\n      let i = 0\r\n      let res = 0\r\n      let y = 0\r\n      let z = 0\r\n      const _a = a.path.split('/')\r\n      const _b = b.path.split('/')\r\n      for (i = 0; i < _a.length; i++) {\r\n        if (res !== 0) {\r\n          break\r\n        }\r\n        y = _a[i] === '*' ? 2 : (_a[i].indexOf(':') > -1 ? 1 : 0)\r\n        z = _b[i] === '*' ? 2 : (_b[i].indexOf(':') > -1 ? 1 : 0)\r\n        res = y - z\r\n        // If a.length >= b.length\r\n        if (i === _b.length - 1 && res === 0) {\r\n          // change order if * found\r\n          res = _a[i] === '*' ? -1 : 1\r\n        }\r\n      }\r\n      return res === 0 ? (_a[i - 1] === '*' && _b[i] ? 1 : -1) : res\r\n    })\r\n  })\r\n  return cleanChildrenRoutes(routes)\r\n}\r\n","import _ from 'lodash'\r\nimport Debug from 'debug'\r\nimport { join, resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport { isUrl, isPureObject } from 'utils'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\nconst Options = {}\r\n\r\nexport default Options\r\n\r\nOptions.from = function (_options) {\r\n  // Clone options to prevent unwanted side-effects\r\n  const options = Object.assign({}, _options)\r\n\r\n  // Normalize options\r\n  if (options.loading === true) {\r\n    delete options.loading\r\n  }\r\n  if (options.router && options.router.middleware && !Array.isArray(options.router.middleware)) {\r\n    options.router.middleware = [options.router.middleware]\r\n  }\r\n  if (options.router && typeof options.router.base === 'string') {\r\n    options._routerBaseSpecified = true\r\n  }\r\n  if (typeof options.transition === 'string') {\r\n    options.transition = { name: options.transition }\r\n  }\r\n  if (typeof options.layoutTransition === 'string') {\r\n    options.layoutTransition = { name: options.layoutTransition }\r\n  }\r\n\r\n  // Apply defaults\r\n  _.defaultsDeep(options, Options.defaults)\r\n\r\n  // Resolve dirs\r\n  const hasValue = v => typeof v === 'string' && v\r\n  options.rootDir = hasValue(options.rootDir) ? options.rootDir : process.cwd()\r\n  options.srcDir = hasValue(options.srcDir) ? resolve(options.rootDir, options.srcDir) : options.rootDir\r\n  options.modulesDir = resolve(options.rootDir, hasValue(options.modulesDir) ? options.modulesDir : 'node_modules')\r\n  options.buildDir = resolve(options.rootDir, options.buildDir)\r\n  options.cacheDir = resolve(options.rootDir, options.cacheDir)\r\n\r\n  // If app.html is defined, set the template path to the user template\r\n  options.appTemplatePath = resolve(options.buildDir, 'views/app.template.html')\r\n  if (existsSync(join(options.srcDir, 'app.html'))) {\r\n    options.appTemplatePath = join(options.srcDir, 'app.html')\r\n  }\r\n\r\n  // Ignore publicPath on dev\r\n  /* istanbul ignore if */\r\n  if (options.dev && isUrl(options.build.publicPath)) {\r\n    options.build.publicPath = Options.defaults.build.publicPath\r\n  }\r\n\r\n  // If store defined, update store options to true unless explicitly disabled\r\n  if (options.store !== false && existsSync(join(options.srcDir, 'store'))) {\r\n    options.store = true\r\n  }\r\n\r\n  // Normalize loadingIndicator\r\n  if (!isPureObject(options.loadingIndicator)) {\r\n    options.loadingIndicator = { name: options.loadingIndicator }\r\n  }\r\n\r\n  // Apply defaults to loadingIndicator\r\n  options.loadingIndicator = Object.assign({\r\n    name: 'pulse',\r\n    color: '#dbe1ec',\r\n    background: 'white'\r\n  }, options.loadingIndicator)\r\n\r\n  // cssSourceMap\r\n  if (options.build.cssSourceMap === undefined) {\r\n    options.build.cssSourceMap = options.dev\r\n  }\r\n\r\n  // Postcss\r\n  // 1. Check if it is explicitly disabled by false value\r\n  // ... Disable all postcss loaders\r\n  // 2. Check if any standard source of postcss config exists\r\n  // ... Make postcss = { config: { path } }\r\n  // 3. Else (Easy Usage)\r\n  // ... Auto merge it with defaults\r\n  if (options.build.postcss !== false) {\r\n    // Detect postcss config existence\r\n    // https://github.com/michael-ciniawsky/postcss-load-config\r\n    let postcssConfigPath\r\n    for (let dir of [options.srcDir, options.rootDir]) {\r\n      for (let file of ['postcss.config.js', '.postcssrc.js', '.postcssrc', '.postcssrc.json', '.postcssrc.yaml']) {\r\n        if (existsSync(resolve(dir, file))) {\r\n          postcssConfigPath = resolve(dir, file)\r\n          break\r\n        }\r\n      }\r\n      if (postcssConfigPath) break\r\n    }\r\n\r\n    // Default postcss options\r\n    if (postcssConfigPath) {\r\n      debug(`Using PostCSS config file: ${postcssConfigPath}`)\r\n      options.build.postcss = {\r\n        sourceMap: options.build.cssSourceMap,\r\n        // https://github.com/postcss/postcss-loader/blob/master/lib/index.js#L79\r\n        config: {\r\n          path: postcssConfigPath\r\n        }\r\n      }\r\n    } else {\r\n      if (Object.keys(options.build.postcss).length) {\r\n        debug('Using PostCSS config from `build.postcss`')\r\n      }\r\n      // Normalize & Apply default plugins\r\n      if (Array.isArray(options.build.postcss)) {\r\n        options.build.postcss = { plugins: options.build.postcss }\r\n      }\r\n      if (isPureObject(options.build.postcss)) {\r\n        options.build.postcss = Object.assign({\r\n          sourceMap: options.build.cssSourceMap,\r\n          plugins: {\r\n            // https://github.com/postcss/postcss-import\r\n            'postcss-import': {\r\n              root: options.rootDir,\r\n              path: [\r\n                options.srcDir,\r\n                options.rootDir,\r\n                options.modulesDir\r\n              ]\r\n            },\r\n            // https://github.com/postcss/postcss-url\r\n            'postcss-url': {},\r\n            // http://cssnext.io/postcss\r\n            'postcss-cssnext': {}\r\n          }\r\n        }, options.build.postcss)\r\n      }\r\n    }\r\n  }\r\n\r\n  // Debug errors\r\n  if (options.debug === undefined) {\r\n    options.debug = options.dev\r\n  }\r\n\r\n  // Apply mode preset\r\n  let modePreset = Options.modes[options.mode || 'universal'] || Options.modes['universal']\r\n  _.defaultsDeep(options, modePreset)\r\n\r\n  // If no server-side rendering, add appear true transition\r\n  if (options.render.ssr === false) {\r\n    options.transition.appear = true\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nOptions.modes = {\r\n  universal: {\r\n    build: {\r\n      ssr: true\r\n    },\r\n    render: {\r\n      ssr: true\r\n    }\r\n  },\r\n  spa: {\r\n    build: {\r\n      ssr: false\r\n    },\r\n    render: {\r\n      ssr: false\r\n    }\r\n  }\r\n}\r\n\r\nOptions.defaults = {\r\n  mode: 'universal',\r\n  dev: process.env.NODE_ENV !== 'production',\r\n  debug: undefined, // Will be equal to dev if not provided\r\n  buildDir: '.nuxt',\r\n  cacheDir: '.cache',\r\n  nuxtAppDir: resolve(__dirname, '../lib/app/'), // Relative to dist\r\n  build: {\r\n    analyze: false,\r\n    dll: false,\r\n    scopeHoisting: false,\r\n    extractCSS: false,\r\n    cssSourceMap: undefined,\r\n    ssr: undefined,\r\n    publicPath: '/_nuxt/',\r\n    filenames: {\r\n      css: 'vendor.[contenthash].css',\r\n      manifest: 'manifest.[hash].js',\r\n      vendor: 'vendor.[chunkhash].js',\r\n      app: 'app.[chunkhash].js',\r\n      chunk: '[name].[chunkhash].js'\r\n    },\r\n    vendor: [],\r\n    plugins: [],\r\n    babel: {},\r\n    postcss: {},\r\n    templates: [],\r\n    watch: [],\r\n    devMiddleware: {},\r\n    hotMiddleware: {}\r\n  },\r\n  generate: {\r\n    dir: 'dist',\r\n    routes: [],\r\n    concurrency: 500,\r\n    interval: 0,\r\n    minify: {\r\n      collapseBooleanAttributes: true,\r\n      collapseWhitespace: false,\r\n      decodeEntities: true,\r\n      minifyCSS: true,\r\n      minifyJS: true,\r\n      processConditionalComments: true,\r\n      removeAttributeQuotes: false,\r\n      removeComments: false,\r\n      removeEmptyAttributes: true,\r\n      removeOptionalTags: true,\r\n      removeRedundantAttributes: true,\r\n      removeScriptTypeAttributes: false,\r\n      removeStyleLinkTypeAttributes: false,\r\n      removeTagWhitespace: false,\r\n      sortAttributes: true,\r\n      sortClassName: false,\r\n      trimCustomFragments: true,\r\n      useShortDoctype: true\r\n    }\r\n  },\r\n  env: {},\r\n  head: {\r\n    meta: [],\r\n    link: [],\r\n    style: [],\r\n    script: []\r\n  },\r\n  plugins: [],\r\n  css: [],\r\n  modules: [],\r\n  layouts: {},\r\n  serverMiddleware: [],\r\n  ErrorPage: null,\r\n  loading: {\r\n    color: 'black',\r\n    failedColor: 'red',\r\n    height: '2px',\r\n    duration: 5000,\r\n    rtl: false\r\n  },\r\n  loadingIndicator: {},\r\n  transition: {\r\n    name: 'page',\r\n    mode: 'out-in',\r\n    appear: false,\r\n    appearClass: 'appear',\r\n    appearActiveClass: 'appear-active',\r\n    appearToClass: 'appear-to'\r\n  },\r\n  layoutTransition: {\r\n    name: 'layout',\r\n    mode: 'out-in'\r\n  },\r\n  router: {\r\n    mode: 'history',\r\n    base: '/',\r\n    routes: [],\r\n    middleware: [],\r\n    linkActiveClass: 'nuxt-link-active',\r\n    linkExactActiveClass: 'nuxt-link-exact-active',\r\n    extendRoutes: null,\r\n    scrollBehavior: null,\r\n    fallback: false\r\n  },\r\n  render: {\r\n    bundleRenderer: {},\r\n    resourceHints: true,\r\n    ssr: undefined,\r\n    http2: {\r\n      push: false\r\n    },\r\n    static: {},\r\n    gzip: {\r\n      threshold: 0\r\n    },\r\n    etag: {\r\n      weak: true // Faster for responses > 5KB\r\n    }\r\n  },\r\n  watchers: {\r\n    webpack: {\r\n      ignored: /-dll/\r\n    },\r\n    chokidar: {}\r\n  },\r\n  editor: {\r\n    editor: 'code'\r\n  },\r\n  hooks: null,\r\n  messages: {\r\n    error_404: 'This page could not be found',\r\n    server_error: 'Server error',\r\n    nuxtjs: 'Nuxt.js',\r\n    back_to_home: 'Back to the home page',\r\n    server_error_details: 'An error occurred in the application and your page could not be served. If you are the application owner, check your logs for details.',\r\n    client_error: 'Error',\r\n    client_error_details: 'An error occurred while rendering the page. Check developer tools console for details.'\r\n  }\r\n}\r\n","import path from 'path'\r\nimport fs from 'fs'\r\nimport { uniq } from 'lodash'\r\nimport hash from 'hash-sum'\r\nimport { chainFn, sequence } from 'utils'\r\nimport Debug from 'debug'\r\n\r\nconst debug = Debug('nuxt:module')\r\n\r\nexport default class ModuleContainer {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n    this.requiredModules = []\r\n  }\r\n\r\n  async ready() {\r\n    await this.nuxt.callHook('modules:before', this, this.options.modules)\r\n    // Load every module in sequence\r\n    await sequence(this.options.modules, this.addModule.bind(this))\r\n    // Call done hook\r\n    await this.nuxt.callHook('modules:done', this)\r\n  }\r\n\r\n  addVendor(vendor) {\r\n    /* istanbul ignore if */\r\n    if (!vendor) {\r\n      return\r\n    }\r\n    this.options.build.vendor = uniq(this.options.build.vendor.concat(vendor))\r\n  }\r\n\r\n  addTemplate(template) {\r\n    /* istanbul ignore if */\r\n    if (!template) {\r\n      return\r\n    }\r\n    // Validate & parse source\r\n    const src = template.src || template\r\n    const srcPath = path.parse(src)\r\n    /* istanbul ignore if */\r\n    if (!src || typeof src !== 'string' || !fs.existsSync(src)) {\r\n      /* istanbul ignore next */\r\n      debug('[nuxt] invalid template', template)\r\n      return\r\n    }\r\n    // Generate unique and human readable dst filename\r\n    const dst = template.fileName ||\r\n      (path.basename(srcPath.dir) + '.' + srcPath.name + '.' + hash(src) + srcPath.ext)\r\n    // Add to templates list\r\n    const templateObj = {\r\n      src,\r\n      dst,\r\n      options: template.options\r\n    }\r\n    this.options.build.templates.push(templateObj)\r\n    return templateObj\r\n  }\r\n\r\n  addPlugin(template) {\r\n    const { dst } = this.addTemplate(template)\r\n    // Add to nuxt plugins\r\n    this.options.plugins.unshift({\r\n      src: path.join(this.options.buildDir, dst),\r\n      ssr: template.ssr\r\n    })\r\n  }\r\n\r\n  addServerMiddleware(middleware) {\r\n    this.options.serverMiddleware.push(middleware)\r\n  }\r\n\r\n  extendBuild(fn) {\r\n    this.options.build.extend = chainFn(this.options.build.extend, fn)\r\n  }\r\n\r\n  extendRoutes(fn) {\r\n    this.options.router.extendRoutes = chainFn(this.options.router.extendRoutes, fn)\r\n  }\r\n\r\n  requireModule(moduleOpts) {\r\n    // Require once\r\n    return this.addModule(moduleOpts, true)\r\n  }\r\n\r\n  async addModule(moduleOpts, requireOnce) {\r\n    /* istanbul ignore if */\r\n    if (!moduleOpts) {\r\n      return\r\n    }\r\n\r\n    // Allow using babel style array options\r\n    if (Array.isArray(moduleOpts)) {\r\n      moduleOpts = {\r\n        src: moduleOpts[0],\r\n        options: moduleOpts[1]\r\n      }\r\n    }\r\n\r\n    // Allows passing runtime options to each module\r\n    const options = moduleOpts.options || (typeof moduleOpts === 'object' ? moduleOpts : {})\r\n    const src = moduleOpts.src || moduleOpts\r\n\r\n    // Resolve module\r\n    let module\r\n    if (typeof src === 'string') {\r\n      module = require(this.nuxt.resolvePath(src))\r\n    }\r\n\r\n    // Validate module\r\n    /* istanbul ignore if */\r\n    if (typeof module !== 'function') {\r\n      throw new Error(`[nuxt] Module ${JSON.stringify(src)} should export a function`)\r\n    }\r\n\r\n    // Module meta\r\n    module.meta = module.meta || {}\r\n    let name = module.meta.name || module.name\r\n\r\n    // If requireOnce specified & module from NPM or with specified name\r\n    if (requireOnce && name) {\r\n      const alreadyRequired = this.requiredModules.indexOf(name) !== -1\r\n      if (requireOnce && alreadyRequired) {\r\n        return\r\n      }\r\n      if (!alreadyRequired) {\r\n        this.requiredModules.push(name)\r\n      }\r\n    }\r\n\r\n    // Call module with `this` context and pass options\r\n    await new Promise((resolve, reject) => {\r\n      const result = module.call(this, options, (err) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n        resolve()\r\n      })\r\n      // If module send back a promise\r\n      if (result && result.then instanceof Function) {\r\n        return result.then(resolve)\r\n      }\r\n      // If not expecting a callback but returns no promise (=synchronous)\r\n      if (module.length < 2) {\r\n        return resolve()\r\n      }\r\n    })\r\n  }\r\n}\r\n","\r\nimport Vue from 'vue'\r\nimport VueMeta from 'vue-meta'\r\nimport VueServerRenderer from 'vue-server-renderer'\r\nimport LRU from 'lru-cache'\r\n\r\nexport default class MetaRenderer {\r\n  constructor(nuxt, renderer) {\r\n    this.nuxt = nuxt\r\n    this.renderer = renderer\r\n    this.options = nuxt.options\r\n    this.vueRenderer = VueServerRenderer.createRenderer()\r\n    this.cache = LRU({})\r\n\r\n    // Add VueMeta to Vue (this is only for SPA mode)\r\n    // See lib/app/index.js\r\n    Vue.use(VueMeta, {\r\n      keyName: 'head',\r\n      attribute: 'data-n-head',\r\n      ssrAttribute: 'data-n-head-ssr',\r\n      tagIDKeyName: 'hid'\r\n    })\r\n  }\r\n\r\n  getMeta(url) {\r\n    return new Promise((resolve, reject) => {\r\n      const vm = new Vue({\r\n        render: (h) => h(), // Render empty html tag\r\n        head: this.options.head || {}\r\n      })\r\n      this.vueRenderer.renderToString(vm, (err) => {\r\n        if (err) return reject(err)\r\n        resolve(vm.$meta().inject())\r\n      })\r\n    })\r\n  }\r\n\r\n  async render({ url = '/' }) {\r\n    let meta = this.cache.get(url)\r\n\r\n    if (meta) {\r\n      return meta\r\n    }\r\n\r\n    meta = {\r\n      HTML_ATTRS: '',\r\n      BODY_ATTRS: '',\r\n      HEAD: '',\r\n      BODY_SCRIPTS: ''\r\n    }\r\n    // Get vue-meta context\r\n    const m = await this.getMeta(url)\r\n    // HTML_ATTRS\r\n    meta.HTML_ATTRS = m.htmlAttrs.text()\r\n    // BODY_ATTRS\r\n    meta.BODY_ATTRS = m.bodyAttrs.text()\r\n    // HEAD tags\r\n    meta.HEAD = m.meta.text() + m.title.text() + m.link.text() + m.style.text() + m.script.text() + m.noscript.text()\r\n    // BODY_SCRIPTS\r\n    meta.BODY_SCRIPTS = m.script.text({ body: true })\r\n    // Resources Hints\r\n    meta.resourceHints = ''\r\n    // Resource Hints\r\n    const clientManifest = this.renderer.resources.clientManifest\r\n    if (this.options.render.resourceHints && clientManifest) {\r\n      const publicPath = clientManifest.publicPath || '/_nuxt/'\r\n      // Pre-Load initial resources\r\n      if (Array.isArray(clientManifest.initial)) {\r\n        meta.resourceHints += clientManifest.initial.map(r => `<link rel=\"preload\" href=\"${publicPath}${r}\" as=\"script\" />`).join('')\r\n      }\r\n      // Pre-Fetch async resources\r\n      if (Array.isArray(clientManifest.async)) {\r\n        meta.resourceHints += clientManifest.async.map(r => `<link rel=\"prefetch\" href=\"${publicPath}${r}\" />`).join('')\r\n      }\r\n      // Add them to HEAD\r\n      if (meta.resourceHints) {\r\n        meta.HEAD += meta.resourceHints\r\n      }\r\n    }\r\n\r\n    // Set meta tags inside cache\r\n    this.cache.set(url, meta)\r\n\r\n    return meta\r\n  }\r\n}\r\n","import ansiHTML from 'ansi-html'\r\nimport serialize from 'serialize-javascript'\r\nimport generateETag from 'etag'\r\nimport fresh from 'fresh'\r\nimport serveStatic from 'serve-static'\r\nimport compression from 'compression'\r\nimport _ from 'lodash'\r\nimport { join, resolve } from 'path'\r\nimport fs from 'fs-extra'\r\nimport { createBundleRenderer } from 'vue-server-renderer'\r\nimport { getContext, setAnsiColors, isUrl } from 'utils'\r\nimport Debug from 'debug'\r\nimport Youch from '@nuxtjs/youch'\r\nimport { SourceMapConsumer } from 'source-map'\r\nimport connect from 'connect'\r\nimport { Options } from 'common'\r\nimport MetaRenderer from './meta'\r\n\r\nconst debug = Debug('nuxt:render')\r\ndebug.color = 4 // Force blue color\r\n\r\nsetAnsiColors(ansiHTML)\r\n\r\nlet jsdom = null\r\n\r\nexport default class Renderer {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n\r\n    // Will be set by createRenderer\r\n    this.bundleRenderer = null\r\n    this.metaRenderer = null\r\n\r\n    // Will be available on dev\r\n    this.webpackDevMiddleware = null\r\n    this.webpackHotMiddleware = null\r\n\r\n    // Create new connect instance\r\n    this.app = connect()\r\n\r\n    // Renderer runtime resources\r\n    this.resources = {\r\n      clientManifest: null,\r\n      serverBundle: null,\r\n      ssrTemplate: null,\r\n      spaTemplate: null,\r\n      errorTemplate: parseTemplate('Nuxt.js Internal Server Error')\r\n    }\r\n  }\r\n\r\n  async ready() {\r\n    await this.nuxt.callHook('render:before', this, this.options.render)\r\n    // Setup nuxt middleware\r\n    await this.setupMiddleware()\r\n\r\n    // Production: Load SSR resources from fs\r\n    if (!this.options.dev) {\r\n      await this.loadResources()\r\n    }\r\n\r\n    // Call done hook\r\n    await this.nuxt.callHook('render:done', this)\r\n  }\r\n\r\n  async loadResources(_fs = fs) {\r\n    let distPath = resolve(this.options.buildDir, 'dist')\r\n    let updated = []\r\n\r\n    resourceMap.forEach(({ key, fileName, transform }) => {\r\n      let rawKey = '$$' + key\r\n      const path = join(distPath, fileName)\r\n\r\n      let rawData, data\r\n      if (!_fs.existsSync(path)) {\r\n        return // Resource not exists\r\n      }\r\n      rawData = _fs.readFileSync(path, 'utf8')\r\n      if (!rawData || rawData === this.resources[rawKey]) {\r\n        return // No changes\r\n      }\r\n      this.resources[rawKey] = rawData\r\n      data = transform(rawData)\r\n      /* istanbul ignore if */\r\n      if (!data) {\r\n        return // Invalid data ?\r\n      }\r\n      this.resources[key] = data\r\n      updated.push(key)\r\n    })\r\n\r\n    // Reload error template\r\n    const errorTemplatePath = resolve(this.options.buildDir, 'views/error.html')\r\n    if (fs.existsSync(errorTemplatePath)) {\r\n      this.resources.errorTemplate = parseTemplate(fs.readFileSync(errorTemplatePath, 'utf8'))\r\n    }\r\n\r\n    // Load loading template\r\n    const loadingHTMLPath = resolve(this.options.buildDir, 'loading.html')\r\n    if (fs.existsSync(loadingHTMLPath)) {\r\n      this.resources.loadingHTML = fs.readFileSync(loadingHTMLPath, 'utf8')\r\n      this.resources.loadingHTML = this.resources.loadingHTML.replace(/[\\r|\\n]/g, '')\r\n    } else {\r\n      this.resources.loadingHTML = ''\r\n    }\r\n\r\n    // Call resourcesLoaded plugin\r\n    await this.nuxt.callHook('render:resourcesLoaded', this.resources)\r\n\r\n    if (updated.length > 0) {\r\n      this.createRenderer()\r\n    }\r\n  }\r\n\r\n  get noSSR() {\r\n    return this.options.render.ssr === false\r\n  }\r\n\r\n  get isReady() {\r\n    if (this.noSSR) {\r\n      return Boolean(this.resources.spaTemplate)\r\n    }\r\n\r\n    return Boolean(this.bundleRenderer && this.resources.ssrTemplate)\r\n  }\r\n\r\n  get isResourcesAvailable() {\r\n    // Required for both\r\n    if (!this.resources.clientManifest) {\r\n      return false\r\n    }\r\n\r\n    // Required for SPA rendering\r\n    if (this.noSSR) {\r\n      return Boolean(this.resources.spaTemplate)\r\n    }\r\n\r\n    // Required for bundle renderer\r\n    return Boolean(this.resources.ssrTemplate && this.resources.serverBundle)\r\n  }\r\n\r\n  createRenderer() {\r\n    // Ensure resources are available\r\n    if (!this.isResourcesAvailable) {\r\n      return\r\n    }\r\n\r\n    // Create Meta Renderer\r\n    this.metaRenderer = new MetaRenderer(this.nuxt, this)\r\n\r\n    // Skip following steps if noSSR mode\r\n    if (this.noSSR) {\r\n      return\r\n    }\r\n\r\n    // Create bundle renderer for SSR\r\n    this.bundleRenderer = createBundleRenderer(this.resources.serverBundle, Object.assign({\r\n      clientManifest: this.resources.clientManifest,\r\n      runInNewContext: false,\r\n      basedir: this.options.rootDir\r\n    }, this.options.render.bundleRenderer))\r\n  }\r\n\r\n  useMiddleware(m) {\r\n    // Resolve\r\n    const $m = m\r\n    let src\r\n    if (typeof m === 'string') {\r\n      src = this.nuxt.resolvePath(m)\r\n      m = require(src)\r\n    }\r\n    if (typeof m.handler === 'string') {\r\n      src = this.nuxt.resolvePath(m.handler)\r\n      m.handler = require(src)\r\n    }\r\n\r\n    const handler = m.handler || m\r\n    const path = (((m.prefix !== false) ? this.options.router.base : '') + (typeof m.path === 'string' ? m.path : '')).replace(/\\/\\//g, '/')\r\n\r\n    // Inject $src and $m to final handler\r\n    if (src) handler.$src = src\r\n    handler.$m = $m\r\n\r\n    // Use middleware\r\n    this.app.use(path, handler)\r\n  }\r\n\r\n  get publicPath() {\r\n    return isUrl(this.options.build.publicPath) ? Options.defaults.build.publicPath : this.options.build.publicPath\r\n  }\r\n\r\n  async setupMiddleware() {\r\n    // Apply setupMiddleware from modules first\r\n    await this.nuxt.callHook('render:setupMiddleware', this.app)\r\n\r\n    // Gzip middleware for production\r\n    if (!this.options.dev && this.options.render.gzip) {\r\n      this.useMiddleware(compression(this.options.render.gzip))\r\n    }\r\n\r\n    // Common URL checks\r\n    this.useMiddleware((req, res, next) => {\r\n      // Prevent access to SSR resources\r\n      if (ssrResourceRegex.test(req.url)) {\r\n        res.statusCode = 404\r\n        return res.end()\r\n      }\r\n      next()\r\n    })\r\n\r\n    // Add webpack middleware only for development\r\n    if (this.options.dev) {\r\n      this.useMiddleware(async (req, res, next) => {\r\n        if (this.webpackDevMiddleware) {\r\n          await this.webpackDevMiddleware(req, res)\r\n        }\r\n        if (this.webpackHotMiddleware) {\r\n          await this.webpackHotMiddleware(req, res)\r\n        }\r\n        next()\r\n      })\r\n    }\r\n\r\n    // open in editor for debug mode only\r\n    const _this = this\r\n    if (this.options.debug) {\r\n      this.useMiddleware({\r\n        path: '_open',\r\n        handler(req, res) {\r\n          // Lazy load open-in-editor\r\n          const openInEditor = require('open-in-editor')\r\n          const editor = openInEditor.configure(_this.options.editor)\r\n          // Parse Query\r\n          const query = req.url.split('?')[1].split('&').reduce((q, part) => {\r\n            const s = part.split('=')\r\n            q[s[0]] = decodeURIComponent(s[1])\r\n            return q\r\n          }, {})\r\n          // eslint-disable-next-line no-console\r\n          console.log('[open in editor]', query.file)\r\n          editor.open(query.file).then(() => {\r\n            res.end('opened in editor!')\r\n          }).catch(err => {\r\n            res.end(err)\r\n          })\r\n        }\r\n      })\r\n    }\r\n\r\n    // For serving static/ files to /\r\n    this.useMiddleware(serveStatic(resolve(this.options.srcDir, 'static'), this.options.render.static))\r\n\r\n    // Serve .nuxt/dist/ files only for production\r\n    // For dev they will be served with devMiddleware\r\n    if (!this.options.dev) {\r\n      const distDir = resolve(this.options.buildDir, 'dist')\r\n      this.useMiddleware({\r\n        path: this.publicPath,\r\n        handler: serveStatic(distDir, {\r\n          index: false, // Don't serve index.html template\r\n          maxAge: '1y' // 1 year in production\r\n        })\r\n      })\r\n    }\r\n\r\n    // Add User provided middleware\r\n    this.options.serverMiddleware.forEach(m => {\r\n      this.useMiddleware(m)\r\n    })\r\n\r\n    // Finally use nuxtMiddleware\r\n    this.useMiddleware(this.nuxtMiddleware.bind(this))\r\n\r\n    // Error middleware for errors that occurred in middleware that declared above\r\n    // Middleware should exactly take 4 arguments\r\n    // https://github.com/senchalabs/connect#error-middleware\r\n    this.useMiddleware(this.errorMiddleware.bind(this))\r\n  }\r\n\r\n  async nuxtMiddleware(req, res, next) {\r\n    // Get context\r\n    const context = getContext(req, res)\r\n\r\n    res.statusCode = 200\r\n    try {\r\n      const result = await this.renderRoute(req.url, context)\r\n      await this.nuxt.callHook('render:route', req.url, result)\r\n      const { html, error, redirected, resourceHints } = result\r\n\r\n      if (redirected) {\r\n        return html\r\n      }\r\n      if (error) {\r\n        res.statusCode = context.nuxt.error.statusCode || 500\r\n      }\r\n\r\n      // Add ETag header\r\n      if (!error && this.options.render.etag) {\r\n        const etag = generateETag(html, this.options.render.etag)\r\n        if (fresh(req.headers, { etag })) {\r\n          res.statusCode = 304\r\n          res.end()\r\n          return\r\n        }\r\n        res.setHeader('ETag', etag)\r\n      }\r\n\r\n      // HTTP2 push headers\r\n      if (!error && this.options.render.http2.push) {\r\n        // Parse resourceHints to extract HTTP.2 prefetch/push headers\r\n        // https://w3c.github.io/preload/#server-push-http-2\r\n        const regex = /link rel=\"([^\"]*)\" href=\"([^\"]*)\" as=\"([^\"]*)\"/g\r\n        const pushAssets = []\r\n        let m\r\n        while (m = regex.exec(resourceHints)) { // eslint-disable-line no-cond-assign\r\n          const [_, rel, href, as] = m // eslint-disable-line no-unused-vars\r\n          if (rel === 'preload') {\r\n            pushAssets.push(`<${href}>; rel=${rel}; as=${as}`)\r\n          }\r\n        }\r\n        // Pass with single Link header\r\n        // https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header\r\n        res.setHeader('Link', pushAssets.join(','))\r\n      }\r\n\r\n      // Send response\r\n      res.setHeader('Content-Type', 'text/html; charset=utf-8')\r\n      res.setHeader('Content-Length', Buffer.byteLength(html))\r\n      res.end(html, 'utf8')\r\n      return html\r\n    } catch (err) {\r\n      /* istanbul ignore if */\r\n      if (context && context.redirected) {\r\n        console.error(err) // eslint-disable-line no-console\r\n        return err\r\n      }\r\n\r\n      next(err)\r\n    }\r\n  }\r\n\r\n  errorMiddleware(err, req, res, next) {\r\n    // ensure statusCode, message and name fields\r\n    err.statusCode = err.statusCode || 500\r\n    err.message = err.message || 'Nuxt Server Error'\r\n    err.name = (!err.name || err.name === 'Error') ? 'NuxtServerError' : err.name\r\n\r\n    // We hide actual errors from end users, so show them on server logs\r\n    if (err.statusCode !== 404) {\r\n      console.error(err) // eslint-disable-line no-console\r\n    }\r\n\r\n    const sendResponse = (content, type = 'text/html') => {\r\n      // Set Headers\r\n      res.statusCode = err.statusCode\r\n      res.statusMessage = err.name\r\n      res.setHeader('Content-Type', type + '; charset=utf-8')\r\n      res.setHeader('Content-Length', Buffer.byteLength(content))\r\n\r\n      // Send Response\r\n      res.end(content, 'utf-8')\r\n    }\r\n\r\n    // Check if request accepts JSON\r\n    const hasReqHeader = (header, includes) => req.headers[header] && req.headers[header].toLowerCase().includes(includes)\r\n    const isJson = hasReqHeader('accept', 'application/json') || hasReqHeader('user-agent', 'curl/')\r\n\r\n    // Use basic errors when debug mode is disabled\r\n    if (!this.options.debug) {\r\n      // Json format is compatible with Youch json responses\r\n      const json = {\r\n        status: err.statusCode,\r\n        message: err.message,\r\n        name: err.name\r\n      }\r\n      if (isJson) {\r\n        sendResponse(JSON.stringify(json, undefined, 2), 'text/json')\r\n        return\r\n      }\r\n      const html = this.resources.errorTemplate(json)\r\n      sendResponse(html)\r\n      return\r\n    }\r\n\r\n    // Show stack trace\r\n    const youch = new Youch(err, req, this.readSource.bind(this))\r\n    if (isJson) {\r\n      youch.toJSON().then(json => { sendResponse(JSON.stringify(json, undefined, 2), 'text/json') })\r\n    } else {\r\n      youch.toHTML().then(html => { sendResponse(html) })\r\n    }\r\n  }\r\n\r\n  async readSource(frame) {\r\n    const serverBundle = this.resources.serverBundle\r\n\r\n    // Remove webpack:/// & query string from the end\r\n    const sanitizeName = name => name ? name.replace('webpack:///', '').split('?')[0] : ''\r\n\r\n    // SourceMap Support for SSR Bundle\r\n    if (serverBundle && serverBundle.maps[frame.fileName]) {\r\n      // Initialize smc cache\r\n      if (!serverBundle.$maps) {\r\n        serverBundle.$maps = {}\r\n      }\r\n\r\n      // Read SourceMap object\r\n      const smc = serverBundle.$maps[frame.fileName] || new SourceMapConsumer(serverBundle.maps[frame.fileName])\r\n      serverBundle.$maps[frame.fileName] = smc\r\n\r\n      // Try to find original position\r\n      const { line, column, name, source } = smc.originalPositionFor({\r\n        line: frame.getLineNumber() || 0,\r\n        column: frame.getColumnNumber() || 0,\r\n        bias: SourceMapConsumer.LEAST_UPPER_BOUND\r\n      })\r\n      if (line) {\r\n        frame.lineNumber = line\r\n      }\r\n      if (column) {\r\n        frame.columnNumber = column\r\n      }\r\n      if (name) {\r\n        frame.functionName = name\r\n      }\r\n      if (source) {\r\n        frame.fileName = sanitizeName(source)\r\n\r\n        // Source detected, try to get original source code\r\n        const contents = smc.sourceContentFor(source)\r\n        if (contents) {\r\n          frame.contents = contents\r\n        }\r\n      }\r\n    }\r\n\r\n    // Return if fileName is still unknown\r\n    if (!frame.fileName) {\r\n      return\r\n    }\r\n\r\n    frame.fileName = sanitizeName(frame.fileName)\r\n\r\n    // Try to read from SSR bundle files\r\n    if (serverBundle && serverBundle.files[frame.fileName]) {\r\n      frame.contents = serverBundle.files[frame.fileName]\r\n      return\r\n    }\r\n\r\n    // Possible paths for file\r\n    const searchPath = [\r\n      this.options.rootDir,\r\n      join(this.options.buildDir, 'dist'),\r\n      this.options.srcDir,\r\n      this.options.buildDir\r\n    ]\r\n\r\n    // Scan filesystem for real path\r\n    for (let pathDir of searchPath) {\r\n      let fullPath = resolve(pathDir, frame.fileName)\r\n      let source = await fs.readFile(fullPath, 'utf-8').catch(() => null)\r\n      if (source) {\r\n        if (!frame.contents) {\r\n          frame.contents = source\r\n        }\r\n        frame.fullPath = fullPath\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  async renderRoute(url, context = {}) {\r\n    /* istanbul ignore if */\r\n    if (!this.isReady) {\r\n      return new Promise(resolve => {\r\n        setTimeout(() => resolve(this.renderRoute(url, context)), 1000)\r\n      })\r\n    }\r\n\r\n    // Log rendered url\r\n    debug(`Rendering url ${url}`)\r\n\r\n    // Add url and isSever to the context\r\n    context.url = url\r\n\r\n    // Basic response if SSR is disabled or spa data provided\r\n    const spa = context.spa || (context.res && context.res.spa)\r\n    const ENV = this.options.env\r\n\r\n    if (this.noSSR || spa) {\r\n      const { HTML_ATTRS, BODY_ATTRS, HEAD, BODY_SCRIPTS, resourceHints } = await this.metaRenderer.render(context)\r\n      const APP = `<div id=\"__nuxt\">${this.resources.loadingHTML}</div>` + BODY_SCRIPTS\r\n\r\n      // Detect 404 errors\r\n      if (url.includes(this.options.build.publicPath) || url.includes('__webpack')) {\r\n        const err = { statusCode: 404, message: this.options.messages.error_404, name: 'ResourceNotFound' }\r\n        throw err\r\n      }\r\n\r\n      const html = this.resources.spaTemplate({\r\n        HTML_ATTRS,\r\n        BODY_ATTRS,\r\n        HEAD,\r\n        APP,\r\n        ENV\r\n      })\r\n\r\n      return { html, resourceHints }\r\n    }\r\n\r\n    // Call renderToString from the bundleRenderer and generate the HTML (will update the context as well)\r\n    let APP = await this.bundleRenderer.renderToString(context)\r\n\r\n    if (!context.nuxt.serverRendered) {\r\n      APP = '<div id=\"__nuxt\"></div>'\r\n    }\r\n    const m = context.meta.inject()\r\n    let HEAD = m.meta.text() + m.title.text() + m.link.text() + m.style.text() + m.script.text() + m.noscript.text()\r\n    if (this.options._routerBaseSpecified) {\r\n      HEAD += `<base href=\"${this.options.router.base}\">`\r\n    }\r\n\r\n    let resourceHints = ''\r\n\r\n    if (this.options.render.resourceHints) {\r\n      resourceHints = context.renderResourceHints()\r\n      HEAD += resourceHints\r\n    }\r\n    APP += `<script type=\"text/javascript\">window.__NUXT__=${serialize(context.nuxt, { isJSON: true })};</script>`\r\n    APP += context.renderScripts()\r\n    APP += m.script.text({ body: true })\r\n\r\n    HEAD += context.renderStyles()\r\n\r\n    let html = this.resources.ssrTemplate({\r\n      HTML_ATTRS: 'data-n-head-ssr ' + m.htmlAttrs.text(),\r\n      BODY_ATTRS: m.bodyAttrs.text(),\r\n      HEAD,\r\n      APP,\r\n      ENV\r\n    })\r\n\r\n    return {\r\n      html,\r\n      resourceHints,\r\n      error: context.nuxt.error,\r\n      redirected: context.redirected\r\n    }\r\n  }\r\n\r\n  async renderAndGetWindow(url, opts = {}) {\r\n    /* istanbul ignore if */\r\n    if (!jsdom) {\r\n      try {\r\n        jsdom = require('jsdom')\r\n      } catch (e) /* istanbul ignore next */ {\r\n        console.error('Fail when calling nuxt.renderAndGetWindow(url)') // eslint-disable-line no-console\r\n        console.error('jsdom module is not installed') // eslint-disable-line no-console\r\n        console.error('Please install jsdom with: npm install --save-dev jsdom') // eslint-disable-line no-console\r\n        throw e\r\n      }\r\n    }\r\n    let options = {\r\n      resources: 'usable', // load subresources (https://github.com/tmpvar/jsdom#loading-subresources)\r\n      runScripts: 'dangerously',\r\n      beforeParse(window) {\r\n        // Mock window.scrollTo\r\n        window.scrollTo = () => {}\r\n      }\r\n    }\r\n    if (opts.virtualConsole !== false) {\r\n      options.virtualConsole = new jsdom.VirtualConsole().sendTo(console)\r\n    }\r\n    url = url || 'http://localhost:3000'\r\n    const { window } = await jsdom.JSDOM.fromURL(url, options)\r\n    // If Nuxt could not be loaded (error from the server-side)\r\n    const nuxtExists = window.document.body.innerHTML.includes(this.options.render.ssr ? 'window.__NUXT__' : '<div id=\"__nuxt\">')\r\n    /* istanbul ignore if */\r\n    if (!nuxtExists) {\r\n      let error = new Error('Could not load the nuxt app')\r\n      error.body = window.document.body.innerHTML\r\n      throw error\r\n    }\r\n    // Used by nuxt.js to say when the components are loaded and the app ready\r\n    await new Promise((resolve) => {\r\n      window._onNuxtLoaded = () => resolve(window)\r\n    })\r\n    // Send back window object\r\n    return window\r\n  }\r\n}\r\n\r\nconst parseTemplate = templateStr => _.template(templateStr, {\r\n  interpolate: /{{([\\s\\S]+?)}}/g\r\n})\r\n\r\nconst resourceMap = [\r\n  {\r\n    key: 'clientManifest',\r\n    fileName: 'vue-ssr-client-manifest.json',\r\n    transform: JSON.parse\r\n  },\r\n  {\r\n    key: 'serverBundle',\r\n    fileName: 'server-bundle.json',\r\n    transform: JSON.parse\r\n  },\r\n  {\r\n    key: 'ssrTemplate',\r\n    fileName: 'index.ssr.html',\r\n    transform: parseTemplate\r\n  },\r\n  {\r\n    key: 'spaTemplate',\r\n    fileName: 'index.spa.html',\r\n    transform: parseTemplate\r\n  }\r\n]\r\n\r\n// Protector utility against request to SSR bundle files\r\nconst ssrResourceRegex = new RegExp(resourceMap.map(resource => resource.fileName).join('|'), 'i')\r\n","import chalk from 'chalk'\r\nimport { Options } from 'common'\r\nimport { sequence } from 'utils'\r\nimport ModuleContainer from './module'\r\nimport Renderer from './renderer'\r\nimport Debug from 'debug'\r\nimport enableDestroy from 'server-destroy'\r\nimport Module from 'module'\r\nimport { isPlainObject } from 'lodash'\r\nimport { join, resolve } from 'path'\r\n\r\nconst debug = Debug('nuxt:')\r\ndebug.color = 5\r\n\r\nexport default class Nuxt {\r\n  constructor(options = {}) {\r\n    this.options = Options.from(options)\r\n\r\n    // Paths for resolving requires from `rootDir`\r\n    this.nodeModulePaths = Module._nodeModulePaths(this.options.rootDir)\r\n\r\n    this.initialized = false\r\n    this.errorHandler = this.errorHandler.bind(this)\r\n    // Hooks\r\n    this._hooks = {}\r\n    this.hook = this.hook.bind(this)\r\n\r\n    // Create instance of core components\r\n    this.moduleContainer = new ModuleContainer(this)\r\n    this.renderer = new Renderer(this)\r\n\r\n    // Backward compatibility\r\n    this.render = this.renderer.app\r\n    this.renderRoute = this.renderer.renderRoute.bind(this.renderer)\r\n    this.renderAndGetWindow = this.renderer.renderAndGetWindow.bind(this.renderer)\r\n\r\n    this._ready = this.ready().catch(this.errorHandler)\r\n  }\r\n\r\n  async ready() {\r\n    if (this._ready) {\r\n      return this._ready\r\n    }\r\n\r\n    // Add hooks\r\n    if (isPlainObject(this.options.hooks)) {\r\n      this.addObjectHooks(this.options.hooks)\r\n    } else if (typeof this.options.hooks === 'function') {\r\n      this.options.hooks(this.hook)\r\n    }\r\n    // Add nuxt modules\r\n    await this.moduleContainer.ready()\r\n    await this.renderer.ready()\r\n\r\n    this.initialized = true\r\n    await this.callHook('ready', this)\r\n\r\n    return this\r\n  }\r\n\r\n  plugin(name, fn) {\r\n    // eslint-disable-next-line no-console\r\n    console.error(`[warn] nuxt.plugin('${name}',..) is deprecated. Please use new hooks system.`)\r\n\r\n    // A tiny backward compatibility util\r\n    const hookMap = {\r\n      'ready': 'ready',\r\n      'close': 'close',\r\n      'listen': 'listen',\r\n      'built': 'build:done'\r\n    }\r\n\r\n    if (hookMap[name]) {\r\n      this.hook(hookMap[name], fn)\r\n    }\r\n\r\n    // Always return nuxt class which has plugin() for two level hooks\r\n    return this\r\n  }\r\n\r\n  hook(name, fn) {\r\n    if (!name || typeof fn !== 'function') {\r\n      return\r\n    }\r\n    this._hooks[name] = this._hooks[name] || []\r\n    this._hooks[name].push(fn)\r\n  }\r\n\r\n  async callHook(name, ...args) {\r\n    if (!this._hooks[name]) {\r\n      return\r\n    }\r\n    debug(`Call ${name} hooks (${this._hooks[name].length})`)\r\n    try {\r\n      await sequence(this._hooks[name], (fn) => fn(...args))\r\n    } catch (err) {\r\n      console.error(`> Error on hook \"${name}\":`) // eslint-disable-line no-console\r\n      console.error(err) // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  addObjectHooks(hooksObj) {\r\n    Object.keys(hooksObj).forEach((name) => {\r\n      let hooks = hooksObj[name]\r\n      hooks = (Array.isArray(hooks) ? hooks : [hooks])\r\n\r\n      hooks.forEach((hook) => {\r\n        this.hook(name, hook)\r\n      })\r\n    })\r\n  }\r\n\r\n  listen(port = 3000, host = 'localhost') {\r\n    return new Promise((resolve, reject) => {\r\n      const server = this.renderer.app.listen({ port, host, exclusive: false }, (err) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n\r\n        const _host = host === '0.0.0.0' ? 'localhost' : host\r\n        // eslint-disable-next-line no-console\r\n        console.log('\\n' + chalk.bgGreen.black(' OPEN ') + chalk.green(` http://${_host}:${port}\\n`))\r\n\r\n        // Close server on nuxt close\r\n        this.hook('close', () => new Promise((resolve, reject) => {\r\n          // Destroy server by forcing every connection to be closed\r\n          server.destroy(err => {\r\n            debug('server closed')\r\n            /* istanbul ignore if */\r\n            if (err) {\r\n              return reject(err)\r\n            }\r\n            resolve()\r\n          })\r\n        }))\r\n\r\n        this.callHook('listen', server, { port, host }).then(resolve)\r\n      })\r\n\r\n      // Add server.destroy(cb) method\r\n      enableDestroy(server)\r\n    })\r\n  }\r\n\r\n  errorHandler/* istanbul ignore next */() {\r\n    // Apply plugins\r\n    // eslint-disable-next-line no-console\r\n    this.callHook('error', ...arguments).catch(console.error)\r\n\r\n    // Silent\r\n    if (this.options.errorHandler === false) {\r\n      return\r\n    }\r\n\r\n    // Custom errorHandler\r\n    if (typeof this.options.errorHandler === 'function') {\r\n      return this.options.errorHandler.apply(this, arguments)\r\n    }\r\n\r\n    // Default handler\r\n    // eslint-disable-next-line no-console\r\n    console.error(...arguments)\r\n  }\r\n\r\n  resolvePath(path) {\r\n    // Try to resolve using NPM resolve path first\r\n    try {\r\n      let resolvedPath = Module._resolveFilename(path, { paths: this.nodeModulePaths })\r\n      return resolvedPath\r\n    } catch (e) {\r\n      // Just continue\r\n    }\r\n    // Shorthand to resolve from project dirs\r\n    if (path.indexOf('@@') === 0 || path.indexOf('~~') === 0) {\r\n      return join(this.options.rootDir, path.substr(2))\r\n    } else if (path.indexOf('@') === 0 || path.indexOf('~') === 0) {\r\n      return join(this.options.srcDir, path.substr(1))\r\n    }\r\n    return resolve(this.options.srcDir, path)\r\n  }\r\n\r\n  async close(callback) {\r\n    await this.callHook('close', this)\r\n\r\n    /* istanbul ignore if */\r\n    if (typeof callback === 'function') {\r\n      await callback()\r\n    }\r\n  }\r\n}\r\n","// Taken from https://github.com/egoist/poi/blob/3e93c88c520db2d20c25647415e6ae0d3de61145/packages/poi/lib/webpack/timefix-plugin.js#L1-L16\r\n// Thanks to @egoist\r\nexport default class TimeFixPlugin {\r\n  constructor(timefix = 11000) {\r\n    this.timefix = timefix\r\n  }\r\n\r\n  apply(compiler) {\r\n    compiler.plugin('watch-run', (watching, callback) => {\r\n      watching.startTime += this.timefix\r\n      callback()\r\n    })\r\n\r\n    compiler.plugin('done', stats => {\r\n      stats.startTime -= this.timefix\r\n    })\r\n  }\r\n}\r\n","import ExtractTextPlugin from 'extract-text-webpack-plugin'\r\nimport { cloneDeep } from 'lodash'\r\nimport { join, resolve } from 'path'\r\nimport webpack from 'webpack'\r\nimport { isUrl, urlJoin } from 'utils'\r\nimport TimeFixPlugin from './timefix-plugin'\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Shared Config\r\n|\r\n| This is the config which is extended by the server and client\r\n| webpack config files\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackBaseConfig(name) {\r\n  const nodeModulesDir = join(__dirname, '..', 'node_modules')\r\n\r\n  const config = {\r\n    name,\r\n    devtool: this.options.dev ? 'cheap-module-source-map' : 'nosources-source-map',\r\n    entry: {\r\n      app: null\r\n    },\r\n    output: {\r\n      path: resolve(this.options.buildDir, 'dist'),\r\n      filename: this.options.build.filenames.app,\r\n      chunkFilename: this.options.build.filenames.chunk,\r\n      publicPath: (isUrl(this.options.build.publicPath)\r\n        ? this.options.build.publicPath\r\n        : urlJoin(this.options.router.base, this.options.build.publicPath))\r\n    },\r\n    performance: {\r\n      maxEntrypointSize: 1000000,\r\n      maxAssetSize: 300000,\r\n      hints: this.options.dev ? false : 'warning'\r\n    },\r\n    resolve: {\r\n      extensions: ['.js', '.json', '.vue', '.ts'],\r\n      alias: {\r\n        '~': join(this.options.srcDir),\r\n        '~~': join(this.options.rootDir),\r\n        '@': join(this.options.srcDir),\r\n        '@@': join(this.options.rootDir),\r\n        // Used by vue-loader so we can use in templates\r\n        // with <img src=\"~/assets/nuxt.png\"/>\r\n        'assets': join(this.options.srcDir, 'assets'),\r\n        'static': join(this.options.srcDir, 'static')\r\n      },\r\n      modules: [\r\n        this.options.modulesDir,\r\n        nodeModulesDir\r\n      ]\r\n    },\r\n    resolveLoader: {\r\n      modules: [\r\n        this.options.modulesDir,\r\n        nodeModulesDir\r\n      ]\r\n    },\r\n    module: {\r\n      noParse: /es6-promise\\.js$/, // Avoid webpack shimming process\r\n      rules: [\r\n        {\r\n          test: /\\.vue$/,\r\n          loader: 'vue-loader',\r\n          options: this.vueLoader()\r\n        },\r\n        {\r\n          test: /\\.js$/,\r\n          loader: 'babel-loader',\r\n          exclude: /node_modules/,\r\n          options: Object.assign({}, this.babelOptions)\r\n        },\r\n        { test: /\\.css$/, use: this.styleLoader('css') },\r\n        { test: /\\.less$/, use: this.styleLoader('less', 'less-loader') },\r\n        { test: /\\.sass$/, use: this.styleLoader('sass', {loader: 'sass-loader', options: { indentedSyntax: true }}) },\r\n        { test: /\\.scss$/, use: this.styleLoader('scss', 'sass-loader') },\r\n        { test: /\\.styl(us)?$/, use: this.styleLoader('stylus', 'stylus-loader') },\r\n        {\r\n          test: /\\.(png|jpe?g|gif|svg)$/,\r\n          loader: 'url-loader',\r\n          options: {\r\n            limit: 1000, // 1KO\r\n            name: 'img/[name].[hash:7].[ext]'\r\n          }\r\n        },\r\n        {\r\n          test: /\\.(woff2?|eot|ttf|otf)(\\?.*)?$/,\r\n          loader: 'url-loader',\r\n          options: {\r\n            limit: 1000, // 1 KO\r\n            name: 'fonts/[name].[hash:7].[ext]'\r\n          }\r\n        },\r\n        {\r\n          test: /\\.(webm|mp4)$/,\r\n          loader: 'file-loader',\r\n          options: {\r\n            name: 'videos/[name].[hash:7].[ext]'\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    plugins: this.options.build.plugins\r\n  }\r\n\r\n  // Add timefix-plugin before others plugins\r\n  config.plugins.unshift(new TimeFixPlugin())\r\n\r\n  // CSS extraction\r\n  const extractCSS = this.options.build.extractCSS\r\n  if (extractCSS) {\r\n    const extractOptions = Object.assign(\r\n      { filename: this.options.build.filenames.css },\r\n      typeof extractCSS === 'object' ? extractCSS : {}\r\n    )\r\n    config.plugins.push(new ExtractTextPlugin(extractOptions))\r\n  }\r\n\r\n  // Workaround for hiding Warnings about plugins without a default export (#1179)\r\n  config.plugins.push({\r\n    apply(compiler) {\r\n      compiler.plugin('done', stats => {\r\n        stats.compilation.warnings = stats.compilation.warnings.filter(warn => {\r\n          if (warn.name === 'ModuleDependencyWarning' && warn.message.includes(`export 'default'`) && warn.message.includes('plugin')) {\r\n            return false\r\n          }\r\n          return true\r\n        })\r\n      })\r\n    }\r\n  })\r\n\r\n  // --------------------------------------\r\n  // Dev specific config\r\n  // --------------------------------------\r\n  if (this.options.dev) {\r\n    //\r\n  }\r\n\r\n  // --------------------------------------\r\n  // Production specific config\r\n  // --------------------------------------\r\n  if (!this.options.dev) {\r\n    // This is needed in webpack 2 for minify CSS\r\n    config.plugins.push(\r\n      new webpack.LoaderOptionsPlugin({\r\n        minimize: true\r\n      })\r\n    )\r\n  }\r\n\r\n  // Clone deep avoid leaking config between Client and Server\r\n  return cloneDeep(config)\r\n}\r\n","import { each } from 'lodash'\r\nimport webpack from 'webpack'\r\nimport VueSSRClientPlugin from 'vue-server-renderer/client-plugin'\r\nimport HTMLPlugin from 'html-webpack-plugin'\r\nimport FriendlyErrorsWebpackPlugin from 'friendly-errors-webpack-plugin'\r\nimport UglifyJSPlugin from 'uglifyjs-webpack-plugin'\r\nimport ProgressBarPlugin from 'progress-bar-webpack-plugin'\r\nimport { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer'\r\nimport { resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport Debug from 'debug'\r\nimport base from './base.config.js'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Client Config\r\n|\r\n| Generate public/dist/client-vendor-bundle.js\r\n| Generate public/dist/client-bundle.js\r\n|\r\n| In production, will generate public/dist/style.css\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackClientConfig() {\r\n  let config = base.call(this, 'client')\r\n\r\n  // Entry points\r\n  config.entry.app = resolve(this.options.buildDir, 'client.js')\r\n  config.entry.vendor = this.vendor()\r\n\r\n  // Add CommonChunks plugin\r\n  commonChunksPlugin.call(this, config)\r\n\r\n  // Env object defined in nuxt.config.js\r\n  let env = {}\r\n  each(this.options.env, (value, key) => {\r\n    env['process.env.' + key] = (['boolean', 'number'].indexOf(typeof value) !== -1 ? value : JSON.stringify(value))\r\n  })\r\n\r\n  // Generate output HTML for SPA\r\n  config.plugins.push(\r\n    new HTMLPlugin({\r\n      filename: 'index.spa.html',\r\n      template: this.options.appTemplatePath,\r\n      inject: true,\r\n      chunksSortMode: 'dependency'\r\n    })\r\n  )\r\n\r\n  // Generate output HTML for SSR\r\n  if (this.options.build.ssr) {\r\n    config.plugins.push(\r\n      new HTMLPlugin({\r\n        filename: 'index.ssr.html',\r\n        template: this.options.appTemplatePath,\r\n        inject: false // Resources will be injected using bundleRenderer\r\n      })\r\n    )\r\n  }\r\n\r\n  // Generate vue-ssr-client-manifest\r\n  config.plugins.push(\r\n    new VueSSRClientPlugin({\r\n      filename: 'vue-ssr-client-manifest.json'\r\n    })\r\n  )\r\n\r\n  // Extract webpack runtime & manifest\r\n  config.plugins.push(\r\n    new webpack.optimize.CommonsChunkPlugin({\r\n      name: 'manifest',\r\n      minChunks: Infinity,\r\n      filename: this.options.build.filenames.manifest\r\n    })\r\n  )\r\n\r\n  // Define Env\r\n  config.plugins.push(\r\n    new webpack.DefinePlugin(Object.assign(env, {\r\n      'process.env.NODE_ENV': JSON.stringify(env.NODE_ENV || (this.options.dev ? 'development' : 'production')),\r\n      'process.env.VUE_ENV': JSON.stringify('client'),\r\n      'process.mode': JSON.stringify(this.options.mode),\r\n      'process.browser': true,\r\n      'process.client': true,\r\n      'process.server': false,\r\n      'process.static': this.isStatic\r\n    }))\r\n  )\r\n\r\n  // Build progress bar\r\n  config.plugins.push(\r\n    new ProgressBarPlugin()\r\n  )\r\n\r\n  // --------------------------------------\r\n  // Dev specific config\r\n  // --------------------------------------\r\n  if (this.options.dev) {\r\n    // Add friendly error plugin\r\n    config.plugins.push(new FriendlyErrorsWebpackPlugin())\r\n\r\n    // https://webpack.js.org/plugins/named-modules-plugin\r\n    config.plugins.push(new webpack.NamedModulesPlugin())\r\n\r\n    // Add HMR support\r\n    config.entry.app = [\r\n      // https://github.com/glenjamin/webpack-hot-middleware#config\r\n      `webpack-hot-middleware/client?name=client&reload=true&timeout=30000&path=${this.options.router.base}/__webpack_hmr`.replace(/\\/\\//g, '/'),\r\n      config.entry.app\r\n    ]\r\n    config.plugins.push(\r\n      new webpack.HotModuleReplacementPlugin(),\r\n      new webpack.NoEmitOnErrorsPlugin()\r\n    )\r\n\r\n    // DllReferencePlugin\r\n    if (this.options.build.dll) {\r\n      dllPlugin.call(this, config)\r\n    }\r\n  }\r\n\r\n  // --------------------------------------\r\n  // Production specific config\r\n  // --------------------------------------\r\n  if (!this.options.dev) {\r\n    // Scope Hoisting\r\n    if (this.options.build.scopeHoisting === true) {\r\n      config.plugins.push(new webpack.optimize.ModuleConcatenationPlugin())\r\n    }\r\n\r\n    // https://webpack.js.org/plugins/hashed-module-ids-plugin\r\n    config.plugins.push(new webpack.HashedModuleIdsPlugin())\r\n\r\n    // Minify JS\r\n    // https://github.com/webpack-contrib/uglifyjs-webpack-plugin\r\n    config.plugins.push(\r\n      new UglifyJSPlugin({\r\n        cache: true,\r\n        sourceMap: true,\r\n        extractComments: {\r\n          filename: 'LICENSES'\r\n        }\r\n      })\r\n    )\r\n\r\n    // Webpack Bundle Analyzer\r\n    if (this.options.build.analyze) {\r\n      config.plugins.push(new BundleAnalyzerPlugin(Object.assign({}, this.options.build.analyze)))\r\n    }\r\n  }\r\n\r\n  // Extend config\r\n  if (typeof this.options.build.extend === 'function') {\r\n    const isDev = this.options.dev\r\n    const extendedConfig = this.options.build.extend.call(this, config, {\r\n      get dev() {\r\n        console.warn('dev has been deprecated in build.extend(), please use isDev') // eslint-disable-line no-console\r\n        return isDev\r\n      },\r\n      isDev,\r\n      isClient: true\r\n    })\r\n    // Only overwrite config when something is returned for backwards compatibility\r\n    if (extendedConfig !== undefined) {\r\n      config = extendedConfig\r\n    }\r\n  }\r\n\r\n  return config\r\n}\r\n\r\n// --------------------------------------------------------------------------\r\n// Adds Common Chunks Plugin\r\n// --------------------------------------------------------------------------\r\nfunction commonChunksPlugin(config) {\r\n  const _this = this\r\n  const totalPages = _this.routes ? _this.routes.length : 0\r\n\r\n  // This well-known vendor may exist as a dependency of other requests.\r\n  const maybeVendor = [\r\n    '/core-js/',\r\n    '/regenerator-runtime/',\r\n    '/es6-promise/',\r\n    '/babel-runtime/',\r\n    '/lodash/'\r\n  ]\r\n\r\n  // Create explicit vendor chunk\r\n  config.plugins.unshift(\r\n    new webpack.optimize.CommonsChunkPlugin({\r\n      name: 'vendor',\r\n      filename: this.options.build.filenames.vendor,\r\n      minChunks(module, count) {\r\n        // Detect and externalize well-known vendor if detected\r\n        if (module.context && maybeVendor.some(v => module.context.includes(v))) {\r\n          return true\r\n        }\r\n        // A module is extracted into the vendor chunk when...\r\n        return (\r\n          // If it's inside node_modules\r\n          /node_modules/.test(module.context) &&\r\n          // Do not externalize if the request is a CSS file\r\n          !/\\.(css|less|scss|sass|styl|stylus)$/.test(module.request) &&\r\n          // Used in at-least 1/2 of the total pages\r\n          (totalPages <= 2 ? count >= totalPages : count >= totalPages * 0.5)\r\n        )\r\n      }\r\n    })\r\n  )\r\n}\r\n\r\n// --------------------------------------------------------------------------\r\n// Adds DLL plugin\r\n// https://github.com/webpack/webpack/tree/master/examples/dll-user\r\n// --------------------------------------------------------------------------\r\nfunction dllPlugin(config) {\r\n  const _dlls = []\r\n  const vendorEntries = this.vendorEntries()\r\n  const dllDir = resolve(this.options.cacheDir, config.name + '-dll')\r\n  Object.keys(vendorEntries).forEach(v => {\r\n    const dllManifestFile = resolve(dllDir, v + '-manifest.json')\r\n    if (existsSync(dllManifestFile)) {\r\n      _dlls.push(v)\r\n      config.plugins.push(\r\n        new webpack.DllReferencePlugin({\r\n          // context: this.options.rootDir,\r\n          manifest: dllManifestFile // Using full path to allow finding .js dll file\r\n        })\r\n      )\r\n    }\r\n  })\r\n  if (_dlls.length) {\r\n    debug('Using dll for ' + _dlls.join(','))\r\n  }\r\n}\r\n","import webpack from 'webpack'\r\nimport VueSSRServerPlugin from 'vue-server-renderer/server-plugin'\r\nimport nodeExternals from 'webpack-node-externals'\r\nimport { each } from 'lodash'\r\nimport { resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport base from './base.config.js'\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Server Config\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackServerConfig() {\r\n  let config = base.call(this, 'server')\r\n\r\n  // env object defined in nuxt.config.js\r\n  let env = {}\r\n  each(this.options.env, (value, key) => {\r\n    env['process.env.' + key] = (['boolean', 'number'].indexOf(typeof value) !== -1 ? value : JSON.stringify(value))\r\n  })\r\n\r\n  config = Object.assign(config, {\r\n    target: 'node',\r\n    node: false,\r\n    devtool: 'source-map',\r\n    entry: resolve(this.options.buildDir, 'server.js'),\r\n    output: Object.assign({}, config.output, {\r\n      filename: 'server-bundle.js',\r\n      libraryTarget: 'commonjs2'\r\n    }),\r\n    performance: {\r\n      hints: false,\r\n      maxAssetSize: Infinity\r\n    },\r\n    externals: [],\r\n    plugins: (config.plugins || []).concat([\r\n      new VueSSRServerPlugin({\r\n        filename: 'server-bundle.json'\r\n      }),\r\n      new webpack.DefinePlugin(Object.assign(env, {\r\n        'process.env.NODE_ENV': JSON.stringify(env.NODE_ENV || (this.options.dev ? 'development' : 'production')),\r\n        'process.env.VUE_ENV': JSON.stringify('server'),\r\n        'process.mode': JSON.stringify(this.options.mode),\r\n        'process.browser': false,\r\n        'process.client': false,\r\n        'process.server': true,\r\n        'process.static': this.isStatic\r\n      }))\r\n    ])\r\n  })\r\n\r\n  // https://webpack.js.org/configuration/externals/#externals\r\n  // https://github.com/liady/webpack-node-externals\r\n  const moduleDirs = [\r\n    this.options.modulesDir\r\n    // Temporary disabled due to vue-server-renderer module search limitations\r\n    // resolve(__dirname, '..', 'node_modules')\r\n  ]\r\n  moduleDirs.forEach(dir => {\r\n    if (existsSync(dir)) {\r\n      config.externals.push(nodeExternals({\r\n        // load non-javascript files with extensions, presumably via loaders\r\n        whitelist: [/es6-promise|\\.(?!(?:js|json)$).{1,5}$/i],\r\n        modulesDir: dir\r\n      }))\r\n    }\r\n  })\r\n\r\n  // --------------------------------------\r\n  // Production specific config\r\n  // --------------------------------------\r\n  if (!this.options.dev) {\r\n\r\n  }\r\n\r\n  // Extend config\r\n  if (typeof this.options.build.extend === 'function') {\r\n    const isDev = this.options.dev\r\n    const extendedConfig = this.options.build.extend.call(this, config, {\r\n      get dev() {\r\n        console.warn('dev has been deprecated in build.extend(), please use isDev') // eslint-disable-line no-console\r\n        return isDev\r\n      },\r\n      isDev,\r\n      isServer: true\r\n    })\r\n    // Only overwrite config when something is returned for backwards compatibility\r\n    if (extendedConfig !== undefined) {\r\n      config = extendedConfig\r\n    }\r\n  }\r\n\r\n  return config\r\n}\r\n","import webpack from 'webpack'\r\nimport { resolve } from 'path'\r\nimport ClientConfig from './client.config'\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Dll Config\r\n| https://github.com/webpack/webpack/tree/master/examples/dll\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackDllConfig(_refConfig) {\r\n  const refConfig = _refConfig || new ClientConfig()\r\n\r\n  const name = refConfig.name + '-dll'\r\n  const dllDir = resolve(this.options.cacheDir, name)\r\n\r\n  let config = {\r\n    name,\r\n    entry: this.vendorEntries(),\r\n    // context: this.options.rootDir,\r\n    resolve: refConfig.resolve,\r\n    target: refConfig.target,\r\n    resolveLoader: refConfig.resolveLoader,\r\n    module: refConfig.module,\r\n    plugins: []\r\n  }\r\n\r\n  config.output = {\r\n    path: dllDir,\r\n    filename: '[name]_[hash].js',\r\n    library: '[name]_[hash]'\r\n  }\r\n\r\n  config.plugins.push(\r\n    new webpack.DllPlugin({\r\n      // The path to the manifest file which maps between\r\n      // modules included in a bundle and the internal IDs\r\n      // within that bundle\r\n      path: resolve(dllDir, '[name]-manifest.json'),\r\n\r\n      name: '[name]_[hash]'\r\n    })\r\n  )\r\n\r\n  return config\r\n}\r\n","export default function vueLoader() {\r\n  // https://vue-loader.vuejs.org/en\r\n  const config = {\r\n    postcss: this.options.build.postcss,\r\n    extractCSS: !!this.options.build.extractCSS,\r\n    cssSourceMap: this.options.build.cssSourceMap,\r\n    preserveWhitespace: false,\r\n    loaders: {\r\n      'js': {\r\n        loader: 'babel-loader',\r\n        options: Object.assign({}, this.babelOptions)\r\n      },\r\n      // Note: do not nest the `postcss` option under `loaders`\r\n      'css': this.styleLoader('css', [], true),\r\n      'less': this.styleLoader('less', 'less-loader', true),\r\n      'scss': this.styleLoader('scss', 'sass-loader', true),\r\n      'sass': this.styleLoader('sass', {loader: 'sass-loader', options: { indentedSyntax: true }}, true),\r\n      'stylus': this.styleLoader('stylus', 'stylus-loader', true),\r\n      'styl': this.styleLoader('stylus', 'stylus-loader', true)\r\n    },\r\n    template: {\r\n      doctype: 'html' // For pug, see https://github.com/vuejs/vue-loader/issues/55\r\n    },\r\n    transformToRequire: {\r\n      video: 'src',\r\n      source: 'src'\r\n    }\r\n  }\r\n\r\n  // Return the config\r\n  return config\r\n}\r\n","import ExtractTextPlugin from 'extract-text-webpack-plugin'\r\nimport { join } from 'path'\r\n\r\nexport default function styleLoader(ext, loaders = [], isVueLoader = false) {\r\n  // Normalize loaders\r\n  loaders = (Array.isArray(loaders) ? loaders : [loaders]).map(loader => {\r\n    if (typeof loader === 'string') {\r\n      loader = { loader }\r\n    }\r\n    return Object.assign({\r\n      options: {\r\n        sourceMap: this.options.build.cssSourceMap\r\n      }\r\n    }, loader)\r\n  })\r\n\r\n  // https://github.com/postcss/postcss-loader\r\n  let postcssLoader\r\n  if (!isVueLoader && this.options.build.postcss) {\r\n    postcssLoader = {\r\n      loader: 'postcss-loader',\r\n      options: this.options.build.postcss\r\n    }\r\n  }\r\n\r\n  // https://github.com/webpack-contrib/css-loader\r\n  const cssLoader = {\r\n    loader: 'css-loader',\r\n    options: {\r\n      minimize: true,\r\n      importLoaders: 1,\r\n      sourceMap: this.options.build.cssSourceMap,\r\n      alias: {\r\n        '/static': join(this.options.srcDir, 'static'),\r\n        '/assets': join(this.options.srcDir, 'assets')\r\n      }\r\n    }\r\n  }\r\n\r\n  // https://github.com/vuejs/vue-style-loader\r\n  const vueStyleLoader = {\r\n    loader: 'vue-style-loader',\r\n    options: {\r\n      sourceMap: this.options.build.cssSourceMap\r\n    }\r\n  }\r\n\r\n  if (this.options.build.extractCSS && !this.options.dev) {\r\n    return ExtractTextPlugin.extract({\r\n      fallback: vueStyleLoader,\r\n      use: [\r\n        cssLoader,\r\n        postcssLoader,\r\n        ...loaders\r\n      ].filter(l => l)\r\n    })\r\n  }\r\n\r\n  return [\r\n    vueStyleLoader,\r\n    cssLoader,\r\n    postcssLoader,\r\n    ...loaders\r\n  ].filter(l => l)\r\n}\r\n","import _ from 'lodash'\r\nimport chokidar from 'chokidar'\r\nimport fs, { remove, readFile, writeFile, mkdirp, existsSync } from 'fs-extra'\r\nimport hash from 'hash-sum'\r\nimport pify from 'pify'\r\nimport webpack from 'webpack'\r\nimport serialize from 'serialize-javascript'\r\nimport { join, resolve, basename, extname, dirname } from 'path'\r\nimport MFS from 'memory-fs'\r\nimport webpackDevMiddleware from 'webpack-dev-middleware'\r\nimport webpackHotMiddleware from 'webpack-hot-middleware'\r\nimport { r, wp, wChunk, createRoutes, sequence, relativeTo, isPureObject } from 'utils'\r\nimport Debug from 'debug'\r\nimport Glob from 'glob'\r\nimport clientWebpackConfig from './webpack/client.config.js'\r\nimport serverWebpackConfig from './webpack/server.config.js'\r\nimport dllWebpackConfig from './webpack/dll.config.js'\r\nimport vueLoaderConfig from './webpack/vue-loader.config'\r\nimport styleLoader from './webpack/style-loader'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\nconst glob = pify(Glob)\r\n\r\nexport default class Builder {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.isStatic = false // Flag to know if the build is for a generated app\r\n    this.options = nuxt.options\r\n\r\n    // Fields that set on build\r\n    this.compilers = []\r\n    this.webpackDevMiddleware = null\r\n    this.webpackHotMiddleware = null\r\n\r\n    // Mute stats on dev\r\n    this.webpackStats = this.options.dev ? false : {\r\n      chunks: false,\r\n      children: false,\r\n      modules: false,\r\n      colors: true,\r\n      excludeAssets: [\r\n        /.map$/,\r\n        /index\\..+\\.html$/,\r\n        /vue-ssr-client-manifest.json/\r\n      ]\r\n    }\r\n\r\n    // Helper to resolve build paths\r\n    this.relativeToBuild = (...args) => relativeTo(this.options.buildDir, ...args)\r\n\r\n    // Bind styleLoader and vueLoader\r\n    this.styleLoader = styleLoader.bind(this)\r\n    this.vueLoader = vueLoaderConfig.bind(this)\r\n\r\n    this._buildStatus = STATUS.INITIAL\r\n  }\r\n\r\n  get plugins() {\r\n    return this.options.plugins.map((p, i) => {\r\n      if (typeof p === 'string') p = { src: p }\r\n      return {\r\n        src: this.nuxt.resolvePath(p.src),\r\n        ssr: (p.ssr !== false),\r\n        name: basename(p.src, extname(p.src)).replace(/[^a-zA-Z?\\d\\s:]/g, '') + '_plugin_' + hash(p.src)\r\n      }\r\n    })\r\n  }\r\n\r\n  vendor() {\r\n    return [\r\n      'vue',\r\n      'vue-router',\r\n      'vue-meta',\r\n      this.options.store && 'vuex'\r\n    ].concat(this.options.build.vendor).filter(v => v)\r\n  }\r\n\r\n  vendorEntries() {\r\n    // Used for dll\r\n    const vendor = this.vendor()\r\n    const vendorEntries = {}\r\n    vendor.forEach(v => {\r\n      try {\r\n        require.resolve(v)\r\n        vendorEntries[v] = [ v ]\r\n      } catch (e) {\r\n        // Ignore\r\n      }\r\n    })\r\n    return vendorEntries\r\n  }\r\n\r\n  forGenerate() {\r\n    this.isStatic = true\r\n  }\r\n\r\n  async build() {\r\n    // Avoid calling build() method multiple times when dev:true\r\n    /* istanbul ignore if */\r\n    if (this._buildStatus === STATUS.BUILD_DONE && this.options.dev) {\r\n      return this\r\n    }\r\n    // If building\r\n    /* istanbul ignore if */\r\n    if (this._buildStatus === STATUS.BUILDING) {\r\n      return new Promise((resolve) => {\r\n        setTimeout(() => {\r\n          resolve(this.build())\r\n        }, 1000)\r\n      })\r\n    }\r\n    this._buildStatus = STATUS.BUILDING\r\n\r\n    // Wait for nuxt ready\r\n    await this.nuxt.ready()\r\n\r\n    // Call before hook\r\n    await this.nuxt.callHook('build:before', this, this.options.build)\r\n\r\n    // Babel options\r\n    this.babelOptions = _.defaults(this.options.build.babel, {\r\n      babelrc: false,\r\n      cacheDirectory: !!this.options.dev\r\n    })\r\n    if (!this.babelOptions.babelrc && !this.babelOptions.presets) {\r\n      this.babelOptions.presets = [\r\n        [require.resolve('babel-preset-vue-app'), {\r\n          targets: { ie: 9, uglify: true }\r\n        }]\r\n      ]\r\n    }\r\n\r\n    // Map postcss plugins into instances on object mode once\r\n    if (isPureObject(this.options.build.postcss)) {\r\n      if (isPureObject(this.options.build.postcss.plugins)) {\r\n        this.options.build.postcss.plugins = Object.keys(this.options.build.postcss.plugins)\r\n          .map(p => {\r\n            const plugin = require(this.nuxt.resolvePath(p))\r\n            const opts = this.options.build.postcss.plugins[p]\r\n            if (opts === false) return // Disabled\r\n            const instance = plugin(opts)\r\n            return instance\r\n          }).filter(e => e)\r\n      }\r\n    }\r\n\r\n    // Check if pages dir exists and warn if not\r\n    this._nuxtPages = typeof this.options.build.createRoutes !== 'function'\r\n    if (this._nuxtPages) {\r\n      if (!fs.existsSync(join(this.options.srcDir, 'pages'))) {\r\n        let dir = this.options.srcDir\r\n        if (fs.existsSync(join(this.options.srcDir, '..', 'pages'))) {\r\n          throw new Error(`No \\`pages\\` directory found in ${dir}. Did you mean to run \\`nuxt\\` in the parent (\\`../\\`) directory?`)\r\n        } else {\r\n          throw new Error(`Couldn't find a \\`pages\\` directory in ${dir}. Please create one under the project root`)\r\n        }\r\n      }\r\n    }\r\n\r\n    debug(`App root: ${this.options.srcDir}`)\r\n    debug(`Generating ${this.options.buildDir} files...`)\r\n\r\n    // Create .nuxt/, .nuxt/components and .nuxt/dist folders\r\n    await remove(r(this.options.buildDir))\r\n    await mkdirp(r(this.options.buildDir, 'components'))\r\n    if (!this.options.dev) {\r\n      await mkdirp(r(this.options.buildDir, 'dist'))\r\n    }\r\n\r\n    // Generate routes and interpret the template files\r\n    await this.generateRoutesAndFiles()\r\n\r\n    // Start webpack build\r\n    await this.webpackBuild()\r\n\r\n    // Flag to set that building is done\r\n    this._buildStatus = STATUS.BUILD_DONE\r\n\r\n    // Call done hook\r\n    await this.nuxt.callHook('build:done', this)\r\n\r\n    return this\r\n  }\r\n\r\n  async generateRoutesAndFiles() {\r\n    debug('Generating files...')\r\n    // -- Templates --\r\n    let templatesFiles = [\r\n      'App.js',\r\n      'client.js',\r\n      'index.js',\r\n      'middleware.js',\r\n      'router.js',\r\n      'server.js',\r\n      'utils.js',\r\n      'empty.js',\r\n      'components/nuxt-error.vue',\r\n      'components/nuxt-loading.vue',\r\n      'components/nuxt-child.js',\r\n      'components/nuxt-link.js',\r\n      'components/nuxt.js',\r\n      'components/no-ssr.js',\r\n      'views/app.template.html',\r\n      'views/error.html'\r\n    ]\r\n    const templateVars = {\r\n      options: this.options,\r\n      messages: this.options.messages,\r\n      uniqBy: _.uniqBy,\r\n      isDev: this.options.dev,\r\n      debug: this.options.debug,\r\n      mode: this.options.mode,\r\n      router: this.options.router,\r\n      env: this.options.env,\r\n      head: this.options.head,\r\n      middleware: fs.existsSync(join(this.options.srcDir, 'middleware')),\r\n      store: this.options.store,\r\n      css: this.options.css,\r\n      plugins: this.plugins,\r\n      appPath: './App.js',\r\n      layouts: Object.assign({}, this.options.layouts),\r\n      loading: typeof this.options.loading === 'string' ? this.relativeToBuild(this.options.srcDir, this.options.loading) : this.options.loading,\r\n      transition: this.options.transition,\r\n      layoutTransition: this.options.layoutTransition,\r\n      components: {\r\n        ErrorPage: this.options.ErrorPage ? this.relativeToBuild(this.options.ErrorPage) : null\r\n      }\r\n    }\r\n\r\n    // -- Layouts --\r\n    if (fs.existsSync(resolve(this.options.srcDir, 'layouts'))) {\r\n      const layoutsFiles = await glob('layouts/**/*.vue', { cwd: this.options.srcDir })\r\n      let hasErrorLayout = false\r\n      layoutsFiles.forEach((file) => {\r\n        let name = file.split('/').slice(1).join('/').replace(/\\.vue$/, '')\r\n        if (name === 'error') {\r\n          hasErrorLayout = true\r\n          return\r\n        }\r\n        templateVars.layouts[name] = this.relativeToBuild(this.options.srcDir, file)\r\n      })\r\n      if (!templateVars.components.ErrorPage && hasErrorLayout) {\r\n        templateVars.components.ErrorPage = this.relativeToBuild(this.options.srcDir, 'layouts/error.vue')\r\n      }\r\n    }\r\n    // If no default layout, create its folder and add the default folder\r\n    if (!templateVars.layouts.default) {\r\n      await mkdirp(r(this.options.buildDir, 'layouts'))\r\n      templatesFiles.push('layouts/default.vue')\r\n      templateVars.layouts.default = './layouts/default.vue'\r\n    }\r\n\r\n    // -- Routes --\r\n    debug('Generating routes...')\r\n    // If user defined a custom method to create routes\r\n    if (this._nuxtPages) {\r\n      // Use nuxt.js createRoutes bases on pages/\r\n      const files = await glob('pages/**/*.vue', { cwd: this.options.srcDir })\r\n      templateVars.router.routes = createRoutes(files, this.options.srcDir)\r\n    } else {\r\n      templateVars.router.routes = this.options.build.createRoutes(this.options.srcDir)\r\n    }\r\n\r\n    await this.nuxt.callHook('build:extendRoutes', templateVars.router.routes, r)\r\n\r\n    // router.extendRoutes method\r\n    if (typeof this.options.router.extendRoutes === 'function') {\r\n      // let the user extend the routes\r\n      const extendedRoutes = this.options.router.extendRoutes(templateVars.router.routes, r)\r\n      // Only overwrite routes when something is returned for backwards compatibility\r\n      if (extendedRoutes !== undefined) {\r\n        templateVars.router.routes = extendedRoutes\r\n      }\r\n    }\r\n\r\n    // Make routes accessible for other modules and webpack configs\r\n    this.routes = templateVars.router.routes\r\n\r\n    // -- Store --\r\n    // Add store if needed\r\n    if (this.options.store) {\r\n      templatesFiles.push('store.js')\r\n    }\r\n\r\n    // Resolve template files\r\n    const customTemplateFiles = this.options.build.templates.map(t => t.dst || basename(t.src || t))\r\n\r\n    templatesFiles = templatesFiles.map(file => {\r\n      // Skip if custom file was already provided in build.templates[]\r\n      if (customTemplateFiles.indexOf(file) !== -1) {\r\n        return\r\n      }\r\n      // Allow override templates using a file with same name in ${srcDir}/app\r\n      const customPath = r(this.options.srcDir, 'app', file)\r\n      const customFileExists = fs.existsSync(customPath)\r\n\r\n      return {\r\n        src: customFileExists\r\n          ? customPath\r\n          : r(this.options.nuxtAppDir, file),\r\n        dst: file,\r\n        custom: customFileExists\r\n      }\r\n    }).filter(i => !!i)\r\n\r\n    // -- Custom templates --\r\n    // Add custom template files\r\n    templatesFiles = templatesFiles.concat(this.options.build.templates.map(t => {\r\n      return Object.assign({\r\n        src: r(this.options.srcDir, t.src || t),\r\n        dst: t.dst || basename(t.src || t),\r\n        custom: true\r\n      }, t)\r\n    }))\r\n\r\n    // -- Loading indicator --\r\n    if (this.options.loadingIndicator.name) {\r\n      const indicatorPath1 = resolve(this.options.nuxtAppDir, 'views/loading', this.options.loadingIndicator.name + '.html')\r\n      const indicatorPath2 = this.nuxt.resolvePath(this.options.loadingIndicator.name)\r\n      const indicatorPath = existsSync(indicatorPath1) ? indicatorPath1 : (existsSync(indicatorPath2) ? indicatorPath2 : null)\r\n      if (indicatorPath) {\r\n        templatesFiles.push({\r\n          src: indicatorPath,\r\n          dst: 'loading.html',\r\n          options: this.options.loadingIndicator\r\n        })\r\n      } else {\r\n        console.error(`Could not fetch loading indicator: ${this.options.loadingIndicator.name}`) // eslint-disable-line no-console\r\n      }\r\n    }\r\n\r\n    await this.nuxt.callHook('build:templates', { templatesFiles, templateVars, resolve: r })\r\n\r\n    // Interpret and move template files to .nuxt/\r\n    await Promise.all(templatesFiles.map(async ({ src, dst, options, custom }) => {\r\n      // Add template to watchers\r\n      this.options.build.watch.push(src)\r\n      // Render template to dst\r\n      const fileContent = await readFile(src, 'utf8')\r\n      let content\r\n      try {\r\n        const template = _.template(fileContent, {\r\n          imports: {\r\n            serialize,\r\n            hash,\r\n            r,\r\n            wp,\r\n            wChunk,\r\n            resolvePath: this.nuxt.resolvePath.bind(this.nuxt),\r\n            relativeToBuild: this.relativeToBuild\r\n          }\r\n        })\r\n        content = template(Object.assign({}, templateVars, {\r\n          options: options || {},\r\n          custom,\r\n          src,\r\n          dst\r\n        }))\r\n      } catch (err) {\r\n        throw new Error(`Could not compile template ${src}: ${err.message}`)\r\n      }\r\n      const path = r(this.options.buildDir, dst)\r\n      // Ensure parent dir exits\r\n      await mkdirp(dirname(path))\r\n      // Write file\r\n      await writeFile(path, content, 'utf8')\r\n    }))\r\n  }\r\n\r\n  async webpackBuild() {\r\n    debug('Building files...')\r\n    const compilersOptions = []\r\n\r\n    // Client\r\n    const clientConfig = clientWebpackConfig.call(this)\r\n    compilersOptions.push(clientConfig)\r\n\r\n    // Server\r\n    let serverConfig = null\r\n    if (this.options.build.ssr) {\r\n      serverConfig = serverWebpackConfig.call(this)\r\n      compilersOptions.push(serverConfig)\r\n    }\r\n\r\n    // Alias plugins to their real path\r\n    this.plugins.forEach(p => {\r\n      const src = this.relativeToBuild(p.src)\r\n\r\n      // Client config\r\n      if (!clientConfig.resolve.alias[p.name]) {\r\n        clientConfig.resolve.alias[p.name] = src\r\n      }\r\n\r\n      // Server config\r\n      if (serverConfig && !serverConfig.resolve.alias[p.name]) {\r\n        // Alias to noop for ssr:false plugins\r\n        serverConfig.resolve.alias[p.name] = p.ssr ? src : './empty.js'\r\n      }\r\n    })\r\n\r\n    // Make a dll plugin after compile to make nuxt dev builds faster\r\n    if (this.options.build.dll && this.options.dev) {\r\n      compilersOptions.push(dllWebpackConfig.call(this, clientConfig))\r\n    }\r\n\r\n    // Initialize shared FS and Cache\r\n    const sharedFS = this.options.dev && new MFS()\r\n    const sharedCache = {}\r\n\r\n    // Initialize compilers\r\n    this.compilers = compilersOptions.map(compilersOption => {\r\n      const compiler = webpack(compilersOption)\r\n      // In dev, write files in memory FS (except for DLL)\r\n      if (sharedFS && !compiler.name.includes('-dll')) {\r\n        compiler.outputFileSystem = sharedFS\r\n      }\r\n      compiler.cache = sharedCache\r\n      return compiler\r\n    })\r\n\r\n    // Start Builds\r\n    await sequence(this.compilers, (compiler) => new Promise(async (resolve, reject) => {\r\n      const name = compiler.options.name\r\n      await this.nuxt.callHook('build:compile', { name, compiler })\r\n\r\n      // Resolve only when compiler emit done event\r\n      compiler.plugin('done', async (stats) => {\r\n        await this.nuxt.callHook('build:compiled', { name, compiler, stats })\r\n        // Reload renderer if available\r\n        this.nuxt.renderer.loadResources(sharedFS || fs)\r\n        // Resolve on next tick\r\n        process.nextTick(resolve)\r\n      })\r\n      // --- Dev Build ---\r\n      if (this.options.dev) {\r\n        // Client Build, watch is started by dev-middleware\r\n        if (compiler.options.name === 'client') {\r\n          return this.webpackDev(compiler)\r\n        }\r\n        // DLL build, should run only once\r\n        if (compiler.options.name.includes('-dll')) {\r\n          compiler.run((err, stats) => {\r\n            if (err) return reject(err)\r\n            debug('[DLL] updated')\r\n          })\r\n          return\r\n        }\r\n        // Server, build and watch for changes\r\n        compiler.watch(this.options.watchers.webpack, (err) => {\r\n          /* istanbul ignore if */\r\n          if (err) return reject(err)\r\n        })\r\n        return\r\n      }\r\n      // --- Production Build ---\r\n      compiler.run((err, stats) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          console.error(err) // eslint-disable-line no-console\r\n          return reject(err)\r\n        }\r\n\r\n        // Show build stats for production\r\n        console.log(stats.toString(this.webpackStats)) // eslint-disable-line no-console\r\n\r\n        /* istanbul ignore if */\r\n        if (stats.hasErrors()) {\r\n          return reject(new Error('Webpack build exited with errors'))\r\n        }\r\n      })\r\n    }))\r\n  }\r\n\r\n  webpackDev(compiler) {\r\n    debug('Adding webpack middleware...')\r\n\r\n    // Create webpack dev middleware\r\n    this.webpackDevMiddleware = pify(webpackDevMiddleware(compiler, Object.assign({\r\n      publicPath: this.options.build.publicPath,\r\n      stats: this.webpackStats,\r\n      noInfo: true,\r\n      quiet: true,\r\n      watchOptions: this.options.watchers.webpack\r\n    }, this.options.build.devMiddleware)))\r\n\r\n    this.webpackHotMiddleware = pify(webpackHotMiddleware(compiler, Object.assign({\r\n      log: false,\r\n      heartbeat: 10000\r\n    }, this.options.build.hotMiddleware)))\r\n\r\n    // Inject to renderer instance\r\n    if (this.nuxt.renderer) {\r\n      this.nuxt.renderer.webpackDevMiddleware = this.webpackDevMiddleware\r\n      this.nuxt.renderer.webpackHotMiddleware = this.webpackHotMiddleware\r\n    }\r\n\r\n    // Stop webpack middleware on nuxt.close()\r\n    this.nuxt.hook('close', () => new Promise(resolve => {\r\n      this.webpackDevMiddleware.close(() => resolve())\r\n    }))\r\n\r\n    // Start watching files\r\n    this.watchFiles()\r\n  }\r\n\r\n  watchFiles() {\r\n    const patterns = [\r\n      r(this.options.srcDir, 'layouts'),\r\n      r(this.options.srcDir, 'store'),\r\n      r(this.options.srcDir, 'middleware'),\r\n      r(this.options.srcDir, 'layouts/*.vue'),\r\n      r(this.options.srcDir, 'layouts/**/*.vue')\r\n    ]\r\n    if (this._nuxtPages) {\r\n      patterns.push(r(this.options.srcDir, 'pages'))\r\n      patterns.push(r(this.options.srcDir, 'pages/*.vue'))\r\n      patterns.push(r(this.options.srcDir, 'pages/**/*.vue'))\r\n    }\r\n    const options = Object.assign({}, this.options.watchers.chokidar, {\r\n      ignoreInitial: true\r\n    })\r\n    /* istanbul ignore next */\r\n    const refreshFiles = _.debounce(() => this.generateRoutesAndFiles(), 200)\r\n\r\n    // Watch for src Files\r\n    let filesWatcher = chokidar.watch(patterns, options)\r\n      .on('add', refreshFiles)\r\n      .on('unlink', refreshFiles)\r\n\r\n    // Watch for custom provided files\r\n    let customFilesWatcher = chokidar.watch(_.uniq(this.options.build.watch), options)\r\n      .on('change', refreshFiles)\r\n\r\n    // Stop watching on nuxt.close()\r\n    this.nuxt.hook('close', () => {\r\n      filesWatcher.close()\r\n      customFilesWatcher.close()\r\n    })\r\n  }\r\n}\r\n\r\nconst STATUS = {\r\n  INITIAL: 1,\r\n  BUILD_DONE: 2,\r\n  BUILDING: 3\r\n}\r\n","import { copy, remove, writeFile, mkdirp, removeSync, existsSync } from 'fs-extra'\r\nimport _ from 'lodash'\r\nimport { resolve, join, dirname, sep } from 'path'\r\nimport { minify } from 'html-minifier'\r\nimport { isUrl, promisifyRoute, waitFor, flatRoutes } from 'utils'\r\nimport Debug from 'debug'\r\n\r\nconst debug = Debug('nuxt:generate')\r\n\r\nexport default class Generator {\r\n  constructor(nuxt, builder) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n    this.builder = builder\r\n\r\n    // Set variables\r\n    this.generateRoutes = resolve(this.options.srcDir, 'static')\r\n    this.srcBuiltPath = resolve(this.options.buildDir, 'dist')\r\n    this.distPath = resolve(this.options.rootDir, this.options.generate.dir)\r\n    this.distNuxtPath = join(this.distPath, (isUrl(this.options.build.publicPath) ? '' : this.options.build.publicPath))\r\n  }\r\n\r\n  async generate({ build = true, init = true } = {}) {\r\n    // Wait for nuxt be ready\r\n    await this.nuxt.ready()\r\n\r\n    // Call before hook\r\n    await this.nuxt.callHook('generate:before', this, this.options.generate)\r\n\r\n    const s = Date.now()\r\n    let errors = []\r\n\r\n    // Add flag to set process.static\r\n    this.builder.forGenerate()\r\n\r\n    // Start build process\r\n    if (build) {\r\n      await this.builder.build()\r\n    }\r\n\r\n    // Initialize dist directory\r\n    if (init) {\r\n      await this.initDist()\r\n    }\r\n\r\n    // Resolve config.generate.routes promises before generating the routes\r\n    let generateRoutes = []\r\n    if (this.options.router.mode !== 'hash') {\r\n      try {\r\n        generateRoutes = await promisifyRoute(this.options.generate.routes || [])\r\n      } catch (e) {\r\n        console.error('Could not resolve routes') // eslint-disable-line no-console\r\n        throw e // eslint-disable-line no-unreachable\r\n      }\r\n    }\r\n\r\n    // Generate only index.html for router.mode = 'hash'\r\n    let routes = (this.options.router.mode === 'hash') ? ['/'] : flatRoutes(this.options.router.routes)\r\n    routes = this.decorateWithPayloads(routes, generateRoutes)\r\n\r\n    // extendRoutes hook\r\n    await this.nuxt.callHook('generate:extendRoutes', routes)\r\n\r\n    // Start generate process\r\n    while (routes.length) {\r\n      let n = 0\r\n      await Promise.all(routes.splice(0, this.options.generate.concurrency).map(async ({ route, payload }) => {\r\n        await waitFor(n++ * this.options.generate.interval)\r\n        await this.generateRoute({ route, payload, errors })\r\n      }))\r\n    }\r\n\r\n    const indexPath = join(this.distPath, 'index.html')\r\n    if (existsSync(indexPath)) {\r\n      // Copy /index.html to /200.html for surge SPA\r\n      // https://surge.sh/help/adding-a-200-page-for-client-side-routing\r\n      const _200Path = join(this.distPath, '200.html')\r\n      if (!existsSync(_200Path)) {\r\n        await copy(indexPath, _200Path)\r\n      }\r\n    }\r\n\r\n    const duration = Math.round((Date.now() - s) / 100) / 10\r\n    debug(`HTML Files generated in ${duration}s`)\r\n\r\n    // done hook\r\n    await this.nuxt.callHook('generate:done', this, errors)\r\n\r\n    if (errors.length) {\r\n      const report = errors.map(({ type, route, error }) => {\r\n        /* istanbul ignore if */\r\n        if (type === 'unhandled') {\r\n          return `Route: '${route}'\\n${error.stack}`\r\n        } else {\r\n          return `Route: '${route}' thrown an error: \\n` + JSON.stringify(error)\r\n        }\r\n      })\r\n      console.error('==== Error report ==== \\n' + report.join('\\n\\n')) // eslint-disable-line no-console\r\n    }\r\n\r\n    return { duration, errors }\r\n  }\r\n\r\n  async initDist() {\r\n    // Clean destination folder\r\n    await remove(this.distPath)\r\n    debug('Destination folder cleaned')\r\n\r\n    // Copy static and built files\r\n    /* istanbul ignore if */\r\n    if (existsSync(this.generateRoutes)) {\r\n      await copy(this.generateRoutes, this.distPath)\r\n    }\r\n    await copy(this.srcBuiltPath, this.distNuxtPath)\r\n\r\n    // Add .nojekyll file to let Github Pages add the _nuxt/ folder\r\n    // https://help.github.com/articles/files-that-start-with-an-underscore-are-missing/\r\n    const nojekyllPath = resolve(this.distPath, '.nojekyll')\r\n    writeFile(nojekyllPath, '')\r\n\r\n    // Cleanup SSR related files\r\n    const extraFiles = [\r\n      'index.spa.html',\r\n      'index.ssr.html',\r\n      'server-bundle.json',\r\n      'vue-ssr-client-manifest.json'\r\n    ].map(file => resolve(this.distNuxtPath, file))\r\n\r\n    extraFiles.forEach(file => {\r\n      if (existsSync(file)) {\r\n        removeSync(file)\r\n      }\r\n    })\r\n\r\n    debug('Static & build files copied')\r\n  }\r\n\r\n  decorateWithPayloads(routes, generateRoutes) {\r\n    let routeMap = {}\r\n    // Fill routeMap for known routes\r\n    routes.forEach((route) => {\r\n      routeMap[route] = {\r\n        route,\r\n        payload: null\r\n      }\r\n    })\r\n    // Fill routeMap with given generate.routes\r\n    generateRoutes.forEach((route) => {\r\n      // route is either a string or like { route : '/my_route/1', payload: {} }\r\n      const path = _.isString(route) ? route : route.route\r\n      routeMap[path] = {\r\n        route: path,\r\n        payload: route.payload || null\r\n      }\r\n    })\r\n    return _.values(routeMap)\r\n  }\r\n\r\n  async generateRoute({ route, payload = {}, errors = [] }) {\r\n    let html\r\n\r\n    try {\r\n      const res = await this.nuxt.renderer.renderRoute(route, { _generate: true, payload })\r\n      html = res.html\r\n      if (res.error) {\r\n        errors.push({ type: 'handled', route, error: res.error })\r\n      }\r\n    } catch (err) {\r\n      /* istanbul ignore next */\r\n      return errors.push({ type: 'unhandled', route, error: err })\r\n    }\r\n\r\n    if (this.options.generate.minify) {\r\n      try {\r\n        html = minify(html, this.options.generate.minify)\r\n      } catch (err) /* istanbul ignore next */ {\r\n        const minifyErr = new Error(`HTML minification failed. Make sure the route generates valid HTML. Failed HTML:\\n ${html}`)\r\n        errors.push({ type: 'unhandled', route, error: minifyErr })\r\n      }\r\n    }\r\n\r\n    let path = join(`${route === '/' ? 'index' : route}.html`) // /about -> /about.html\r\n    path = (path === '/404/index.html') ? '/404.html' : path // /404 -> /404.html\r\n\r\n    // Call hook to let user update the path & html\r\n    const page = { route, path, html }\r\n    await this.nuxt.callHook('generate:page', page)\r\n\r\n    debug('Generate file: ' + page.path)\r\n    page.path = join(this.distPath, page.path)\r\n\r\n    // Make sure the sub folders are created\r\n    await mkdirp(dirname(page.path))\r\n    await writeFile(page.path, page.html, 'utf8')\r\n\r\n    return true\r\n  }\r\n}\r\n","import * as core from './core'\r\nimport * as builder from './builder'\r\n\r\nexport default Object.assign({}, core, builder)\r\n"],"names":["encodeHtml","str","replace","getContext","req","res","setAnsiColors","ansiHTML","setColors","ms","Promise","resolve","waitFor","urlJoin","slice","call","arguments","join","isUrl","url","indexOf","promisifyRoute","fn","Array","isArray","length","reject","err","routeParams","promise","then","sequence","tasks","reduce","task","parallel","all","map","chainFn","base","Function","apply","baseResult","undefined","fnResult","prototype","isPureObject","o","isWindows","test","process","platform","wp","p","wChunk","reqSep","sysSep","_","escapeRegExp","sep","normalize","string","r","args","lastArg","last","includes","relativeTo","dir","shift","path","rp","relative","flatRoutes","router","routes","forEach","children","push","cleanChildrenRoutes","isChild","start","routesIndex","route","name","split","s","names","paths","i","a","find","child","createRoutes","files","srcDir","file","keys","component","parent","key","chunkName","sort","b","y","z","_a","_b","debug","Debug","color","Options","from","_options","options","Object","assign","loading","middleware","_routerBaseSpecified","transition","layoutTransition","defaultsDeep","defaults","hasValue","v","rootDir","cwd","modulesDir","buildDir","cacheDir","appTemplatePath","existsSync","dev","build","publicPath","store","loadingIndicator","cssSourceMap","postcss","postcssConfigPath","plugins","modePreset","modes","mode","render","ssr","appear","env","NODE_ENV","__dirname","ModuleContainer","nuxt","requiredModules","callHook","modules","addModule","bind","vendor","uniq","concat","template","src","srcPath","parse","fs","dst","fileName","basename","hash","ext","templateObj","templates","addTemplate","unshift","serverMiddleware","extend","extendRoutes","moduleOpts","requireOnce","module","require","resolvePath","Error","JSON","stringify","meta","alreadyRequired","result","MetaRenderer","renderer","vueRenderer","VueServerRenderer","createRenderer","cache","LRU","use","VueMeta","vm","Vue","h","head","renderToString","$meta","inject","get","m","getMeta","HTML_ATTRS","htmlAttrs","text","BODY_ATTRS","bodyAttrs","HEAD","title","link","style","script","noscript","BODY_SCRIPTS","body","resourceHints","clientManifest","resources","initial","async","set","jsdom","Renderer","bundleRenderer","metaRenderer","webpackDevMiddleware","webpackHotMiddleware","app","connect","parseTemplate","setupMiddleware","loadResources","_fs","distPath","updated","transform","rawKey","rawData","data","readFileSync","errorTemplatePath","errorTemplate","loadingHTMLPath","loadingHTML","noSSR","isReady","Boolean","spaTemplate","ssrTemplate","isResourcesAvailable","serverBundle","createBundleRenderer","$m","handler","prefix","$src","gzip","useMiddleware","compression","next","ssrResourceRegex","statusCode","end","_this","openInEditor","editor","configure","query","q","part","decodeURIComponent","log","open","catch","serveStatic","static","distDir","nuxtMiddleware","errorMiddleware","context","renderRoute","html","error","redirected","etag","generateETag","fresh","headers","setHeader","http2","regex","pushAssets","exec","rel","href","as","Buffer","byteLength","message","sendResponse","content","type","statusMessage","hasReqHeader","header","toLowerCase","isJson","json","youch","Youch","readSource","toJSON","toHTML","frame","sanitizeName","maps","$maps","smc","SourceMapConsumer","line","column","source","originalPositionFor","getLineNumber","getColumnNumber","LEAST_UPPER_BOUND","lineNumber","columnNumber","functionName","contents","sourceContentFor","searchPath","pathDir","fullPath","readFile","spa","ENV","APP","messages","error_404","serverRendered","renderResourceHints","serialize","isJSON","renderScripts","renderStyles","opts","e","window","scrollTo","virtualConsole","VirtualConsole","sendTo","console","JSDOM","fromURL","nuxtExists","document","innerHTML","_onNuxtLoaded","templateStr","resourceMap","RegExp","resource","Nuxt","nodeModulePaths","Module","_nodeModulePaths","initialized","errorHandler","_hooks","hook","moduleContainer","renderAndGetWindow","_ready","ready","isPlainObject","hooks","addObjectHooks","hookMap","hooksObj","port","host","server","listen","exclusive","_host","chalk","bgGreen","black","green","destroy","resolvedPath","_resolveFilename","substr","callback","TimeFixPlugin","timefix","compiler","plugin","watching","startTime","stats","webpackBaseConfig","nodeModulesDir","config","filenames","chunk","vueLoader","babelOptions","styleLoader","loader","indentedSyntax","extractCSS","extractOptions","filename","css","ExtractTextPlugin","compilation","warnings","filter","warn","webpack","LoaderOptionsPlugin","cloneDeep","webpackClientConfig","entry","value","HTMLPlugin","VueSSRClientPlugin","optimize","CommonsChunkPlugin","Infinity","manifest","DefinePlugin","isStatic","ProgressBarPlugin","FriendlyErrorsWebpackPlugin","NamedModulesPlugin","HotModuleReplacementPlugin","NoEmitOnErrorsPlugin","dll","scopeHoisting","ModuleConcatenationPlugin","HashedModuleIdsPlugin","UglifyJSPlugin","analyze","BundleAnalyzerPlugin","isDev","extendedConfig","commonChunksPlugin","totalPages","maybeVendor","count","some","request","dllPlugin","_dlls","vendorEntries","dllDir","dllManifestFile","DllReferencePlugin","webpackServerConfig","output","VueSSRServerPlugin","moduleDirs","externals","nodeExternals","webpackDllConfig","_refConfig","refConfig","ClientConfig","target","resolveLoader","DllPlugin","loaders","isVueLoader","postcssLoader","cssLoader","vueStyleLoader","extract","l","glob","pify","Glob","Builder","compilers","webpackStats","relativeToBuild","vueLoaderConfig","_buildStatus","STATUS","INITIAL","extname","BUILD_DONE","BUILDING","babel","babelrc","presets","ie","uglify","instance","_nuxtPages","remove","mkdirp","generateRoutesAndFiles","webpackBuild","templatesFiles","templateVars","uniqBy","layouts","ErrorPage","layoutsFiles","hasErrorLayout","components","default","extendedRoutes","customTemplateFiles","t","customPath","customFileExists","nuxtAppDir","indicatorPath1","indicatorPath2","indicatorPath","custom","watch","fileContent","dirname","writeFile","compilersOptions","clientConfig","clientWebpackConfig","serverConfig","serverWebpackConfig","alias","dllWebpackConfig","sharedFS","MFS","sharedCache","compilersOption","outputFileSystem","nextTick","webpackDev","run","watchers","toString","hasErrors","devMiddleware","hotMiddleware","close","watchFiles","patterns","chokidar","refreshFiles","debounce","filesWatcher","on","customFilesWatcher","Generator","builder","generateRoutes","srcBuiltPath","generate","distNuxtPath","init","Date","now","errors","forGenerate","initDist","decorateWithPayloads","n","splice","concurrency","payload","interval","generateRoute","indexPath","_200Path","copy","duration","Math","round","report","stack","nojekyllPath","extraFiles","routeMap","isString","values","_generate","minify","minifyErr","page","core"],"mappings":"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"}