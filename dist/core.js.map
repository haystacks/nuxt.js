{"version":3,"file":"core.js","sources":["../lib/common/utils.js","../lib/common/options.js","../lib/core/module.js","../lib/core/meta.js","../lib/core/renderer.js","../lib/core/nuxt.js"],"sourcesContent":["import { resolve, relative, sep } from 'path'\r\nimport _ from 'lodash'\r\n\r\nexport function encodeHtml(str) {\r\n  return str.replace(/</g, '&lt;').replace(/>/g, '&gt;')\r\n}\r\n\r\nexport function getContext(req, res) {\r\n  return { req, res }\r\n}\r\n\r\nexport function setAnsiColors(ansiHTML) {\r\n  ansiHTML.setColors({\r\n    reset: ['efefef', 'a6004c'],\r\n    darkgrey: '5a012b',\r\n    yellow: 'ffab07',\r\n    green: 'aeefba',\r\n    magenta: 'ff84bf',\r\n    blue: '3505a0',\r\n    cyan: '56eaec',\r\n    red: '4e053a'\r\n  })\r\n}\r\n\r\nexport async function waitFor(ms) {\r\n  return new Promise(function (resolve) {\r\n    setTimeout(resolve, (ms || 0))\r\n  })\r\n}\r\n\r\nexport function urlJoin() {\r\n  return [].slice.call(arguments).join('/').replace(/\\/+/g, '/').replace(':/', '://')\r\n}\r\n\r\nexport function isUrl(url) {\r\n  return (url.indexOf('http') === 0 || url.indexOf('//') === 0)\r\n}\r\n\r\nexport function promisifyRoute(fn) {\r\n  // If routes is an array\r\n  if (Array.isArray(fn)) {\r\n    return Promise.resolve(fn)\r\n  }\r\n  // If routes is a function expecting a callback\r\n  if (fn.length === 1) {\r\n    return new Promise((resolve, reject) => {\r\n      fn(function (err, routeParams) {\r\n        if (err) {\r\n          reject(err)\r\n        }\r\n        resolve(routeParams)\r\n      })\r\n    })\r\n  }\r\n  let promise = fn()\r\n  if (!promise || (!(promise instanceof Promise) && (typeof promise.then !== 'function'))) {\r\n    promise = Promise.resolve(promise)\r\n  }\r\n  return promise\r\n}\r\n\r\nexport function sequence(tasks, fn) {\r\n  return tasks.reduce((promise, task) => promise.then(() => fn(task)), Promise.resolve())\r\n}\r\n\r\nexport function parallel(tasks, fn) {\r\n  return Promise.all(tasks.map(task => fn(task)))\r\n}\r\n\r\nexport function chainFn(base, fn) {\r\n  /* istanbul ignore if */\r\n  if (!(fn instanceof Function)) {\r\n    return\r\n  }\r\n  return function () {\r\n    if (typeof base !== 'function') {\r\n      return fn.apply(this, arguments)\r\n    }\r\n    let baseResult = base.apply(this, arguments)\r\n    // Allow function to mutate the first argument instead of returning the result\r\n    if (baseResult === undefined) {\r\n      baseResult = arguments[0]\r\n    }\r\n    let fnResult = fn.call(this, baseResult, ...Array.prototype.slice.call(arguments, 1))\r\n    // Return mutated argument if no result was returned\r\n    if (fnResult === undefined) {\r\n      return baseResult\r\n    }\r\n    return fnResult\r\n  }\r\n}\r\n\r\nexport function isPureObject(o) {\r\n  return !Array.isArray(o) && typeof o === 'object'\r\n}\r\n\r\nexport const isWindows = /^win/.test(process.platform)\r\n\r\nexport function wp(p = '') {\r\n  /* istanbul ignore if */\r\n  if (isWindows) {\r\n    return p.replace(/\\\\/g, '\\\\\\\\')\r\n  }\r\n  return p\r\n}\r\n\r\nexport function wChunk(p = '') {\r\n  /* istanbul ignore if */\r\n  if (isWindows) {\r\n    return p.replace(/\\//g, '\\\\\\\\')\r\n  }\r\n  return p\r\n}\r\n\r\nconst reqSep = /\\//g\r\nconst sysSep = _.escapeRegExp(sep)\r\nconst normalize = string => string.replace(reqSep, sysSep)\r\n\r\nexport function r() {\r\n  let args = Array.prototype.slice.apply(arguments)\r\n  let lastArg = _.last(args)\r\n\r\n  if (lastArg.includes('@') || lastArg.includes('~')) {\r\n    return wp(lastArg)\r\n  }\r\n\r\n  return wp(resolve(...args.map(normalize)))\r\n}\r\n\r\nexport function relativeTo() {\r\n  let args = Array.prototype.slice.apply(arguments)\r\n  let dir = args.shift()\r\n\r\n  // Resolve path\r\n  let path = r(...args)\r\n\r\n  // Check if path is an alias\r\n  if (path.includes('@') || path.includes('~')) {\r\n    return path\r\n  }\r\n\r\n  // Make correct relative path\r\n  let rp = relative(dir, path)\r\n  if (rp[0] !== '.') {\r\n    rp = './' + rp\r\n  }\r\n  return wp(rp)\r\n}\r\n\r\nexport function flatRoutes(router, path = '', routes = []) {\r\n  router.forEach((r) => {\r\n    if (!r.path.includes(':') && !r.path.includes('*')) {\r\n      /* istanbul ignore if */\r\n      if (r.children) {\r\n        flatRoutes(r.children, path + r.path + '/', routes)\r\n      } else {\r\n        routes.push((r.path === '' && path[path.length - 1] === '/' ? path.slice(0, -1) : path) + r.path)\r\n      }\r\n    }\r\n  })\r\n  return routes\r\n}\r\n\r\nexport function cleanChildrenRoutes(routes, isChild = false) {\r\n  let start = -1\r\n  let routesIndex = []\r\n  routes.forEach((route) => {\r\n    if (/-index$/.test(route.name) || route.name === 'index') {\r\n      // Save indexOf 'index' key in name\r\n      let res = route.name.split('-')\r\n      let s = res.indexOf('index')\r\n      start = (start === -1 || s < start) ? s : start\r\n      routesIndex.push(res)\r\n    }\r\n  })\r\n  routes.forEach((route) => {\r\n    route.path = (isChild) ? route.path.replace('/', '') : route.path\r\n    if (route.path.indexOf('?') > -1) {\r\n      let names = route.name.split('-')\r\n      let paths = route.path.split('/')\r\n      if (!isChild) {\r\n        paths.shift()\r\n      } // clean first / for parents\r\n      routesIndex.forEach((r) => {\r\n        let i = r.indexOf('index') - start //  children names\r\n        if (i < paths.length) {\r\n          for (let a = 0; a <= i; a++) {\r\n            if (a === i) {\r\n              paths[a] = paths[a].replace('?', '')\r\n            }\r\n            if (a < i && names[a] !== r[a]) {\r\n              break\r\n            }\r\n          }\r\n        }\r\n      })\r\n      route.path = (isChild ? '' : '/') + paths.join('/')\r\n    }\r\n    route.name = route.name.replace(/-index$/, '')\r\n    if (route.children) {\r\n      if (route.children.find((child) => child.path === '')) {\r\n        delete route.name\r\n      }\r\n      route.children = cleanChildrenRoutes(route.children, true)\r\n    }\r\n  })\r\n  return routes\r\n}\r\n\r\nexport function createRoutes(files, srcDir) {\r\n  let routes = []\r\n  files.forEach((file) => {\r\n    let keys = file.replace(/^pages/, '').replace(/\\.vue$/, '').replace(/\\/{2,}/g, '/').split('/').slice(1)\r\n    let route = { name: '', path: '', component: r(srcDir, file) }\r\n    let parent = routes\r\n    keys.forEach((key, i) => {\r\n      route.name = route.name ? route.name + '-' + key.replace('_', '') : key.replace('_', '')\r\n      route.name += (key === '_') ? 'all' : ''\r\n      route.chunkName = file.replace(/\\.vue$/, '')\r\n      let child = _.find(parent, { name: route.name })\r\n      if (child) {\r\n        child.children = child.children || []\r\n        parent = child.children\r\n        route.path = ''\r\n      } else {\r\n        if (key === 'index' && (i + 1) === keys.length) {\r\n          route.path += (i > 0 ? '' : '/')\r\n        } else {\r\n          route.path += '/' + (key === '_' ? '*' : key.replace('_', ':'))\r\n          if (key !== '_' && key.indexOf('_') !== -1) {\r\n            route.path += '?'\r\n          }\r\n        }\r\n      }\r\n    })\r\n    // Order Routes path\r\n    parent.push(route)\r\n    parent.sort((a, b) => {\r\n      if (!a.path.length || a.path === '/') {\r\n        return -1\r\n      }\r\n      if (!b.path.length || b.path === '/') {\r\n        return 1\r\n      }\r\n      let i = 0\r\n      let res = 0\r\n      let y = 0\r\n      let z = 0\r\n      const _a = a.path.split('/')\r\n      const _b = b.path.split('/')\r\n      for (i = 0; i < _a.length; i++) {\r\n        if (res !== 0) {\r\n          break\r\n        }\r\n        y = _a[i] === '*' ? 2 : (_a[i].indexOf(':') > -1 ? 1 : 0)\r\n        z = _b[i] === '*' ? 2 : (_b[i].indexOf(':') > -1 ? 1 : 0)\r\n        res = y - z\r\n        // If a.length >= b.length\r\n        if (i === _b.length - 1 && res === 0) {\r\n          // change order if * found\r\n          res = _a[i] === '*' ? -1 : 1\r\n        }\r\n      }\r\n      return res === 0 ? (_a[i - 1] === '*' && _b[i] ? 1 : -1) : res\r\n    })\r\n  })\r\n  return cleanChildrenRoutes(routes)\r\n}\r\n","import _ from 'lodash'\r\nimport Debug from 'debug'\r\nimport { join, resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport { isUrl, isPureObject } from 'utils'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\nconst Options = {}\r\n\r\nexport default Options\r\n\r\nOptions.from = function (_options) {\r\n  // Clone options to prevent unwanted side-effects\r\n  const options = Object.assign({}, _options)\r\n\r\n  // Normalize options\r\n  if (options.loading === true) {\r\n    delete options.loading\r\n  }\r\n  if (options.router && options.router.middleware && !Array.isArray(options.router.middleware)) {\r\n    options.router.middleware = [options.router.middleware]\r\n  }\r\n  if (options.router && typeof options.router.base === 'string') {\r\n    options._routerBaseSpecified = true\r\n  }\r\n  if (typeof options.transition === 'string') {\r\n    options.transition = { name: options.transition }\r\n  }\r\n  if (typeof options.layoutTransition === 'string') {\r\n    options.layoutTransition = { name: options.layoutTransition }\r\n  }\r\n\r\n  // Apply defaults\r\n  _.defaultsDeep(options, Options.defaults)\r\n\r\n  // Resolve dirs\r\n  const hasValue = v => typeof v === 'string' && v\r\n  options.rootDir = hasValue(options.rootDir) ? options.rootDir : process.cwd()\r\n  options.srcDir = hasValue(options.srcDir) ? resolve(options.rootDir, options.srcDir) : options.rootDir\r\n  options.modulesDir = resolve(options.rootDir, hasValue(options.modulesDir) ? options.modulesDir : 'node_modules')\r\n  options.buildDir = resolve(options.rootDir, options.buildDir)\r\n  options.cacheDir = resolve(options.rootDir, options.cacheDir)\r\n\r\n  // If app.html is defined, set the template path to the user template\r\n  options.appTemplatePath = resolve(options.buildDir, 'views/app.template.html')\r\n  if (existsSync(join(options.srcDir, 'app.html'))) {\r\n    options.appTemplatePath = join(options.srcDir, 'app.html')\r\n  }\r\n\r\n  // Ignore publicPath on dev\r\n  /* istanbul ignore if */\r\n  if (options.dev && isUrl(options.build.publicPath)) {\r\n    options.build.publicPath = Options.defaults.build.publicPath\r\n  }\r\n\r\n  // If store defined, update store options to true unless explicitly disabled\r\n  if (options.store !== false && existsSync(join(options.srcDir, 'store'))) {\r\n    options.store = true\r\n  }\r\n\r\n  // Normalize loadingIndicator\r\n  if (!isPureObject(options.loadingIndicator)) {\r\n    options.loadingIndicator = { name: options.loadingIndicator }\r\n  }\r\n\r\n  // Apply defaults to loadingIndicator\r\n  options.loadingIndicator = Object.assign({\r\n    name: 'pulse',\r\n    color: '#dbe1ec',\r\n    background: 'white'\r\n  }, options.loadingIndicator)\r\n\r\n  // cssSourceMap\r\n  if (options.build.cssSourceMap === undefined) {\r\n    options.build.cssSourceMap = options.dev\r\n  }\r\n\r\n  // Postcss\r\n  // 1. Check if it is explicitly disabled by false value\r\n  // ... Disable all postcss loaders\r\n  // 2. Check if any standard source of postcss config exists\r\n  // ... Make postcss = { config: { path } }\r\n  // 3. Else (Easy Usage)\r\n  // ... Auto merge it with defaults\r\n  if (options.build.postcss !== false) {\r\n    // Detect postcss config existence\r\n    // https://github.com/michael-ciniawsky/postcss-load-config\r\n    let postcssConfigPath\r\n    for (let dir of [options.srcDir, options.rootDir]) {\r\n      for (let file of ['postcss.config.js', '.postcssrc.js', '.postcssrc', '.postcssrc.json', '.postcssrc.yaml']) {\r\n        if (existsSync(resolve(dir, file))) {\r\n          postcssConfigPath = resolve(dir, file)\r\n          break\r\n        }\r\n      }\r\n      if (postcssConfigPath) break\r\n    }\r\n\r\n    // Default postcss options\r\n    if (postcssConfigPath) {\r\n      debug(`Using PostCSS config file: ${postcssConfigPath}`)\r\n      options.build.postcss = {\r\n        sourceMap: options.build.cssSourceMap,\r\n        // https://github.com/postcss/postcss-loader/blob/master/lib/index.js#L79\r\n        config: {\r\n          path: postcssConfigPath\r\n        }\r\n      }\r\n    } else {\r\n      if (Object.keys(options.build.postcss).length) {\r\n        debug('Using PostCSS config from `build.postcss`')\r\n      }\r\n      // Normalize & Apply default plugins\r\n      if (Array.isArray(options.build.postcss)) {\r\n        options.build.postcss = { plugins: options.build.postcss }\r\n      }\r\n      if (isPureObject(options.build.postcss)) {\r\n        options.build.postcss = Object.assign({\r\n          sourceMap: options.build.cssSourceMap,\r\n          plugins: {\r\n            // https://github.com/postcss/postcss-import\r\n            'postcss-import': {\r\n              root: options.rootDir,\r\n              path: [\r\n                options.srcDir,\r\n                options.rootDir,\r\n                options.modulesDir\r\n              ]\r\n            },\r\n            // https://github.com/postcss/postcss-url\r\n            'postcss-url': {},\r\n            // http://cssnext.io/postcss\r\n            'postcss-cssnext': {}\r\n          }\r\n        }, options.build.postcss)\r\n      }\r\n    }\r\n  }\r\n\r\n  // Debug errors\r\n  if (options.debug === undefined) {\r\n    options.debug = options.dev\r\n  }\r\n\r\n  // Apply mode preset\r\n  let modePreset = Options.modes[options.mode || 'universal'] || Options.modes['universal']\r\n  _.defaultsDeep(options, modePreset)\r\n\r\n  // If no server-side rendering, add appear true transition\r\n  if (options.render.ssr === false) {\r\n    options.transition.appear = true\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nOptions.modes = {\r\n  universal: {\r\n    build: {\r\n      ssr: true\r\n    },\r\n    render: {\r\n      ssr: true\r\n    }\r\n  },\r\n  spa: {\r\n    build: {\r\n      ssr: false\r\n    },\r\n    render: {\r\n      ssr: false\r\n    }\r\n  }\r\n}\r\n\r\nOptions.defaults = {\r\n  mode: 'universal',\r\n  dev: process.env.NODE_ENV !== 'production',\r\n  debug: undefined, // Will be equal to dev if not provided\r\n  buildDir: '.nuxt',\r\n  cacheDir: '.cache',\r\n  nuxtAppDir: resolve(__dirname, '../lib/app/'), // Relative to dist\r\n  build: {\r\n    analyze: false,\r\n    dll: false,\r\n    scopeHoisting: false,\r\n    extractCSS: false,\r\n    cssSourceMap: undefined,\r\n    ssr: undefined,\r\n    publicPath: '/_nuxt/',\r\n    filenames: {\r\n      css: 'vendor.[contenthash].css',\r\n      manifest: 'manifest.[hash].js',\r\n      vendor: 'vendor.[chunkhash].js',\r\n      app: 'app.[chunkhash].js',\r\n      chunk: '[name].[chunkhash].js'\r\n    },\r\n    vendor: [],\r\n    plugins: [],\r\n    babel: {},\r\n    postcss: {},\r\n    templates: [],\r\n    watch: [],\r\n    devMiddleware: {},\r\n    hotMiddleware: {}\r\n  },\r\n  generate: {\r\n    dir: 'dist',\r\n    routes: [],\r\n    concurrency: 500,\r\n    interval: 0,\r\n    minify: {\r\n      collapseBooleanAttributes: true,\r\n      collapseWhitespace: false,\r\n      decodeEntities: true,\r\n      minifyCSS: true,\r\n      minifyJS: true,\r\n      processConditionalComments: true,\r\n      removeAttributeQuotes: false,\r\n      removeComments: false,\r\n      removeEmptyAttributes: true,\r\n      removeOptionalTags: true,\r\n      removeRedundantAttributes: true,\r\n      removeScriptTypeAttributes: false,\r\n      removeStyleLinkTypeAttributes: false,\r\n      removeTagWhitespace: false,\r\n      sortAttributes: true,\r\n      sortClassName: false,\r\n      trimCustomFragments: true,\r\n      useShortDoctype: true\r\n    }\r\n  },\r\n  env: {},\r\n  head: {\r\n    meta: [],\r\n    link: [],\r\n    style: [],\r\n    script: []\r\n  },\r\n  plugins: [],\r\n  css: [],\r\n  modules: [],\r\n  layouts: {},\r\n  serverMiddleware: [],\r\n  ErrorPage: null,\r\n  loading: {\r\n    color: 'black',\r\n    failedColor: 'red',\r\n    height: '2px',\r\n    duration: 5000,\r\n    rtl: false\r\n  },\r\n  loadingIndicator: {},\r\n  transition: {\r\n    name: 'page',\r\n    mode: 'out-in',\r\n    appear: false,\r\n    appearClass: 'appear',\r\n    appearActiveClass: 'appear-active',\r\n    appearToClass: 'appear-to'\r\n  },\r\n  layoutTransition: {\r\n    name: 'layout',\r\n    mode: 'out-in'\r\n  },\r\n  router: {\r\n    mode: 'history',\r\n    base: '/',\r\n    routes: [],\r\n    middleware: [],\r\n    linkActiveClass: 'nuxt-link-active',\r\n    linkExactActiveClass: 'nuxt-link-exact-active',\r\n    extendRoutes: null,\r\n    scrollBehavior: null,\r\n    fallback: false\r\n  },\r\n  render: {\r\n    bundleRenderer: {},\r\n    resourceHints: true,\r\n    ssr: undefined,\r\n    http2: {\r\n      push: false\r\n    },\r\n    static: {},\r\n    gzip: {\r\n      threshold: 0\r\n    },\r\n    etag: {\r\n      weak: true // Faster for responses > 5KB\r\n    }\r\n  },\r\n  watchers: {\r\n    webpack: {\r\n      ignored: /-dll/\r\n    },\r\n    chokidar: {}\r\n  },\r\n  editor: {\r\n    editor: 'code'\r\n  },\r\n  hooks: null,\r\n  messages: {\r\n    error_404: 'This page could not be found',\r\n    server_error: 'Server error',\r\n    nuxtjs: 'Nuxt.js',\r\n    back_to_home: 'Back to the home page',\r\n    server_error_details: 'An error occurred in the application and your page could not be served. If you are the application owner, check your logs for details.',\r\n    client_error: 'Error',\r\n    client_error_details: 'An error occurred while rendering the page. Check developer tools console for details.'\r\n  }\r\n}\r\n","import path from 'path'\r\nimport fs from 'fs'\r\nimport { uniq } from 'lodash'\r\nimport hash from 'hash-sum'\r\nimport { chainFn, sequence } from 'utils'\r\nimport Debug from 'debug'\r\n\r\nconst debug = Debug('nuxt:module')\r\n\r\nexport default class ModuleContainer {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n    this.requiredModules = []\r\n  }\r\n\r\n  async ready() {\r\n    await this.nuxt.callHook('modules:before', this, this.options.modules)\r\n    // Load every module in sequence\r\n    await sequence(this.options.modules, this.addModule.bind(this))\r\n    // Call done hook\r\n    await this.nuxt.callHook('modules:done', this)\r\n  }\r\n\r\n  addVendor(vendor) {\r\n    /* istanbul ignore if */\r\n    if (!vendor) {\r\n      return\r\n    }\r\n    this.options.build.vendor = uniq(this.options.build.vendor.concat(vendor))\r\n  }\r\n\r\n  addTemplate(template) {\r\n    /* istanbul ignore if */\r\n    if (!template) {\r\n      return\r\n    }\r\n    // Validate & parse source\r\n    const src = template.src || template\r\n    const srcPath = path.parse(src)\r\n    /* istanbul ignore if */\r\n    if (!src || typeof src !== 'string' || !fs.existsSync(src)) {\r\n      /* istanbul ignore next */\r\n      debug('[nuxt] invalid template', template)\r\n      return\r\n    }\r\n    // Generate unique and human readable dst filename\r\n    const dst = template.fileName ||\r\n      (path.basename(srcPath.dir) + '.' + srcPath.name + '.' + hash(src) + srcPath.ext)\r\n    // Add to templates list\r\n    const templateObj = {\r\n      src,\r\n      dst,\r\n      options: template.options\r\n    }\r\n    this.options.build.templates.push(templateObj)\r\n    return templateObj\r\n  }\r\n\r\n  addPlugin(template) {\r\n    const { dst } = this.addTemplate(template)\r\n    // Add to nuxt plugins\r\n    this.options.plugins.unshift({\r\n      src: path.join(this.options.buildDir, dst),\r\n      ssr: template.ssr\r\n    })\r\n  }\r\n\r\n  addServerMiddleware(middleware) {\r\n    this.options.serverMiddleware.push(middleware)\r\n  }\r\n\r\n  extendBuild(fn) {\r\n    this.options.build.extend = chainFn(this.options.build.extend, fn)\r\n  }\r\n\r\n  extendRoutes(fn) {\r\n    this.options.router.extendRoutes = chainFn(this.options.router.extendRoutes, fn)\r\n  }\r\n\r\n  requireModule(moduleOpts) {\r\n    // Require once\r\n    return this.addModule(moduleOpts, true)\r\n  }\r\n\r\n  async addModule(moduleOpts, requireOnce) {\r\n    /* istanbul ignore if */\r\n    if (!moduleOpts) {\r\n      return\r\n    }\r\n\r\n    // Allow using babel style array options\r\n    if (Array.isArray(moduleOpts)) {\r\n      moduleOpts = {\r\n        src: moduleOpts[0],\r\n        options: moduleOpts[1]\r\n      }\r\n    }\r\n\r\n    // Allows passing runtime options to each module\r\n    const options = moduleOpts.options || (typeof moduleOpts === 'object' ? moduleOpts : {})\r\n    const src = moduleOpts.src || moduleOpts\r\n\r\n    // Resolve module\r\n    let module\r\n    if (typeof src === 'string') {\r\n      module = require(this.nuxt.resolvePath(src))\r\n    }\r\n\r\n    // Validate module\r\n    /* istanbul ignore if */\r\n    if (typeof module !== 'function') {\r\n      throw new Error(`[nuxt] Module ${JSON.stringify(src)} should export a function`)\r\n    }\r\n\r\n    // Module meta\r\n    module.meta = module.meta || {}\r\n    let name = module.meta.name || module.name\r\n\r\n    // If requireOnce specified & module from NPM or with specified name\r\n    if (requireOnce && name) {\r\n      const alreadyRequired = this.requiredModules.indexOf(name) !== -1\r\n      if (requireOnce && alreadyRequired) {\r\n        return\r\n      }\r\n      if (!alreadyRequired) {\r\n        this.requiredModules.push(name)\r\n      }\r\n    }\r\n\r\n    // Call module with `this` context and pass options\r\n    await new Promise((resolve, reject) => {\r\n      const result = module.call(this, options, (err) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n        resolve()\r\n      })\r\n      // If module send back a promise\r\n      if (result && result.then instanceof Function) {\r\n        return result.then(resolve)\r\n      }\r\n      // If not expecting a callback but returns no promise (=synchronous)\r\n      if (module.length < 2) {\r\n        return resolve()\r\n      }\r\n    })\r\n  }\r\n}\r\n","\r\nimport Vue from 'vue'\r\nimport VueMeta from 'vue-meta'\r\nimport VueServerRenderer from 'vue-server-renderer'\r\nimport LRU from 'lru-cache'\r\n\r\nexport default class MetaRenderer {\r\n  constructor(nuxt, renderer) {\r\n    this.nuxt = nuxt\r\n    this.renderer = renderer\r\n    this.options = nuxt.options\r\n    this.vueRenderer = VueServerRenderer.createRenderer()\r\n    this.cache = LRU({})\r\n\r\n    // Add VueMeta to Vue (this is only for SPA mode)\r\n    // See lib/app/index.js\r\n    Vue.use(VueMeta, {\r\n      keyName: 'head',\r\n      attribute: 'data-n-head',\r\n      ssrAttribute: 'data-n-head-ssr',\r\n      tagIDKeyName: 'hid'\r\n    })\r\n  }\r\n\r\n  getMeta(url) {\r\n    return new Promise((resolve, reject) => {\r\n      const vm = new Vue({\r\n        render: (h) => h(), // Render empty html tag\r\n        head: this.options.head || {}\r\n      })\r\n      this.vueRenderer.renderToString(vm, (err) => {\r\n        if (err) return reject(err)\r\n        resolve(vm.$meta().inject())\r\n      })\r\n    })\r\n  }\r\n\r\n  async render({ url = '/' }) {\r\n    let meta = this.cache.get(url)\r\n\r\n    if (meta) {\r\n      return meta\r\n    }\r\n\r\n    meta = {\r\n      HTML_ATTRS: '',\r\n      BODY_ATTRS: '',\r\n      HEAD: '',\r\n      BODY_SCRIPTS: ''\r\n    }\r\n    // Get vue-meta context\r\n    const m = await this.getMeta(url)\r\n    // HTML_ATTRS\r\n    meta.HTML_ATTRS = m.htmlAttrs.text()\r\n    // BODY_ATTRS\r\n    meta.BODY_ATTRS = m.bodyAttrs.text()\r\n    // HEAD tags\r\n    meta.HEAD = m.meta.text() + m.title.text() + m.link.text() + m.style.text() + m.script.text() + m.noscript.text()\r\n    // BODY_SCRIPTS\r\n    meta.BODY_SCRIPTS = m.script.text({ body: true })\r\n    // Resources Hints\r\n    meta.resourceHints = ''\r\n    // Resource Hints\r\n    const clientManifest = this.renderer.resources.clientManifest\r\n    if (this.options.render.resourceHints && clientManifest) {\r\n      const publicPath = clientManifest.publicPath || '/_nuxt/'\r\n      // Pre-Load initial resources\r\n      if (Array.isArray(clientManifest.initial)) {\r\n        meta.resourceHints += clientManifest.initial.map(r => `<link rel=\"preload\" href=\"${publicPath}${r}\" as=\"script\" />`).join('')\r\n      }\r\n      // Pre-Fetch async resources\r\n      if (Array.isArray(clientManifest.async)) {\r\n        meta.resourceHints += clientManifest.async.map(r => `<link rel=\"prefetch\" href=\"${publicPath}${r}\" />`).join('')\r\n      }\r\n      // Add them to HEAD\r\n      if (meta.resourceHints) {\r\n        meta.HEAD += meta.resourceHints\r\n      }\r\n    }\r\n\r\n    // Set meta tags inside cache\r\n    this.cache.set(url, meta)\r\n\r\n    return meta\r\n  }\r\n}\r\n","import ansiHTML from 'ansi-html'\r\nimport serialize from 'serialize-javascript'\r\nimport generateETag from 'etag'\r\nimport fresh from 'fresh'\r\nimport serveStatic from 'serve-static'\r\nimport compression from 'compression'\r\nimport _ from 'lodash'\r\nimport { join, resolve } from 'path'\r\nimport fs from 'fs-extra'\r\nimport { createBundleRenderer } from 'vue-server-renderer'\r\nimport { getContext, setAnsiColors, isUrl } from 'utils'\r\nimport Debug from 'debug'\r\nimport Youch from '@nuxtjs/youch'\r\nimport { SourceMapConsumer } from 'source-map'\r\nimport connect from 'connect'\r\nimport { Options } from 'common'\r\nimport MetaRenderer from './meta'\r\n\r\nconst debug = Debug('nuxt:render')\r\ndebug.color = 4 // Force blue color\r\n\r\nsetAnsiColors(ansiHTML)\r\n\r\nlet jsdom = null\r\n\r\nexport default class Renderer {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n\r\n    // Will be set by createRenderer\r\n    this.bundleRenderer = null\r\n    this.metaRenderer = null\r\n\r\n    // Will be available on dev\r\n    this.webpackDevMiddleware = null\r\n    this.webpackHotMiddleware = null\r\n\r\n    // Create new connect instance\r\n    this.app = connect()\r\n\r\n    // Renderer runtime resources\r\n    this.resources = {\r\n      clientManifest: null,\r\n      serverBundle: null,\r\n      ssrTemplate: null,\r\n      spaTemplate: null,\r\n      errorTemplate: parseTemplate('Nuxt.js Internal Server Error')\r\n    }\r\n  }\r\n\r\n  async ready() {\r\n    await this.nuxt.callHook('render:before', this, this.options.render)\r\n    // Setup nuxt middleware\r\n    await this.setupMiddleware()\r\n\r\n    // Production: Load SSR resources from fs\r\n    if (!this.options.dev) {\r\n      await this.loadResources()\r\n    }\r\n\r\n    // Call done hook\r\n    await this.nuxt.callHook('render:done', this)\r\n  }\r\n\r\n  async loadResources(_fs = fs) {\r\n    let distPath = resolve(this.options.buildDir, 'dist')\r\n    let updated = []\r\n\r\n    resourceMap.forEach(({ key, fileName, transform }) => {\r\n      let rawKey = '$$' + key\r\n      const path = join(distPath, fileName)\r\n\r\n      let rawData, data\r\n      if (!_fs.existsSync(path)) {\r\n        return // Resource not exists\r\n      }\r\n      rawData = _fs.readFileSync(path, 'utf8')\r\n      if (!rawData || rawData === this.resources[rawKey]) {\r\n        return // No changes\r\n      }\r\n      this.resources[rawKey] = rawData\r\n      data = transform(rawData)\r\n      /* istanbul ignore if */\r\n      if (!data) {\r\n        return // Invalid data ?\r\n      }\r\n      this.resources[key] = data\r\n      updated.push(key)\r\n    })\r\n\r\n    // Reload error template\r\n    const errorTemplatePath = resolve(this.options.buildDir, 'views/error.html')\r\n    if (fs.existsSync(errorTemplatePath)) {\r\n      this.resources.errorTemplate = parseTemplate(fs.readFileSync(errorTemplatePath, 'utf8'))\r\n    }\r\n\r\n    // Load loading template\r\n    const loadingHTMLPath = resolve(this.options.buildDir, 'loading.html')\r\n    if (fs.existsSync(loadingHTMLPath)) {\r\n      this.resources.loadingHTML = fs.readFileSync(loadingHTMLPath, 'utf8')\r\n      this.resources.loadingHTML = this.resources.loadingHTML.replace(/[\\r|\\n]/g, '')\r\n    } else {\r\n      this.resources.loadingHTML = ''\r\n    }\r\n\r\n    // Call resourcesLoaded plugin\r\n    await this.nuxt.callHook('render:resourcesLoaded', this.resources)\r\n\r\n    if (updated.length > 0) {\r\n      this.createRenderer()\r\n    }\r\n  }\r\n\r\n  get noSSR() {\r\n    return this.options.render.ssr === false\r\n  }\r\n\r\n  get isReady() {\r\n    if (this.noSSR) {\r\n      return Boolean(this.resources.spaTemplate)\r\n    }\r\n\r\n    return Boolean(this.bundleRenderer && this.resources.ssrTemplate)\r\n  }\r\n\r\n  get isResourcesAvailable() {\r\n    // Required for both\r\n    if (!this.resources.clientManifest) {\r\n      return false\r\n    }\r\n\r\n    // Required for SPA rendering\r\n    if (this.noSSR) {\r\n      return Boolean(this.resources.spaTemplate)\r\n    }\r\n\r\n    // Required for bundle renderer\r\n    return Boolean(this.resources.ssrTemplate && this.resources.serverBundle)\r\n  }\r\n\r\n  createRenderer() {\r\n    // Ensure resources are available\r\n    if (!this.isResourcesAvailable) {\r\n      return\r\n    }\r\n\r\n    // Create Meta Renderer\r\n    this.metaRenderer = new MetaRenderer(this.nuxt, this)\r\n\r\n    // Skip following steps if noSSR mode\r\n    if (this.noSSR) {\r\n      return\r\n    }\r\n\r\n    // Create bundle renderer for SSR\r\n    this.bundleRenderer = createBundleRenderer(this.resources.serverBundle, Object.assign({\r\n      clientManifest: this.resources.clientManifest,\r\n      runInNewContext: false,\r\n      basedir: this.options.rootDir\r\n    }, this.options.render.bundleRenderer))\r\n  }\r\n\r\n  useMiddleware(m) {\r\n    // Resolve\r\n    const $m = m\r\n    let src\r\n    if (typeof m === 'string') {\r\n      src = this.nuxt.resolvePath(m)\r\n      m = require(src)\r\n    }\r\n    if (typeof m.handler === 'string') {\r\n      src = this.nuxt.resolvePath(m.handler)\r\n      m.handler = require(src)\r\n    }\r\n\r\n    const handler = m.handler || m\r\n    const path = (((m.prefix !== false) ? this.options.router.base : '') + (typeof m.path === 'string' ? m.path : '')).replace(/\\/\\//g, '/')\r\n\r\n    // Inject $src and $m to final handler\r\n    if (src) handler.$src = src\r\n    handler.$m = $m\r\n\r\n    // Use middleware\r\n    this.app.use(path, handler)\r\n  }\r\n\r\n  get publicPath() {\r\n    return isUrl(this.options.build.publicPath) ? Options.defaults.build.publicPath : this.options.build.publicPath\r\n  }\r\n\r\n  async setupMiddleware() {\r\n    // Apply setupMiddleware from modules first\r\n    await this.nuxt.callHook('render:setupMiddleware', this.app)\r\n\r\n    // Gzip middleware for production\r\n    if (!this.options.dev && this.options.render.gzip) {\r\n      this.useMiddleware(compression(this.options.render.gzip))\r\n    }\r\n\r\n    // Common URL checks\r\n    this.useMiddleware((req, res, next) => {\r\n      // Prevent access to SSR resources\r\n      if (ssrResourceRegex.test(req.url)) {\r\n        res.statusCode = 404\r\n        return res.end()\r\n      }\r\n      next()\r\n    })\r\n\r\n    // Add webpack middleware only for development\r\n    if (this.options.dev) {\r\n      this.useMiddleware(async (req, res, next) => {\r\n        if (this.webpackDevMiddleware) {\r\n          await this.webpackDevMiddleware(req, res)\r\n        }\r\n        if (this.webpackHotMiddleware) {\r\n          await this.webpackHotMiddleware(req, res)\r\n        }\r\n        next()\r\n      })\r\n    }\r\n\r\n    // open in editor for debug mode only\r\n    const _this = this\r\n    if (this.options.debug) {\r\n      this.useMiddleware({\r\n        path: '_open',\r\n        handler(req, res) {\r\n          // Lazy load open-in-editor\r\n          const openInEditor = require('open-in-editor')\r\n          const editor = openInEditor.configure(_this.options.editor)\r\n          // Parse Query\r\n          const query = req.url.split('?')[1].split('&').reduce((q, part) => {\r\n            const s = part.split('=')\r\n            q[s[0]] = decodeURIComponent(s[1])\r\n            return q\r\n          }, {})\r\n          // eslint-disable-next-line no-console\r\n          console.log('[open in editor]', query.file)\r\n          editor.open(query.file).then(() => {\r\n            res.end('opened in editor!')\r\n          }).catch(err => {\r\n            res.end(err)\r\n          })\r\n        }\r\n      })\r\n    }\r\n\r\n    // For serving static/ files to /\r\n    this.useMiddleware(serveStatic(resolve(this.options.srcDir, 'static'), this.options.render.static))\r\n\r\n    // Serve .nuxt/dist/ files only for production\r\n    // For dev they will be served with devMiddleware\r\n    if (!this.options.dev) {\r\n      const distDir = resolve(this.options.buildDir, 'dist')\r\n      this.useMiddleware({\r\n        path: this.publicPath,\r\n        handler: serveStatic(distDir, {\r\n          index: false, // Don't serve index.html template\r\n          maxAge: '1y' // 1 year in production\r\n        })\r\n      })\r\n    }\r\n\r\n    // Add User provided middleware\r\n    this.options.serverMiddleware.forEach(m => {\r\n      this.useMiddleware(m)\r\n    })\r\n\r\n    // Finally use nuxtMiddleware\r\n    this.useMiddleware(this.nuxtMiddleware.bind(this))\r\n\r\n    // Error middleware for errors that occurred in middleware that declared above\r\n    // Middleware should exactly take 4 arguments\r\n    // https://github.com/senchalabs/connect#error-middleware\r\n    this.useMiddleware(this.errorMiddleware.bind(this))\r\n  }\r\n\r\n  async nuxtMiddleware(req, res, next) {\r\n    // Get context\r\n    const context = getContext(req, res)\r\n\r\n    res.statusCode = 200\r\n    try {\r\n      const result = await this.renderRoute(req.url, context)\r\n      await this.nuxt.callHook('render:route', req.url, result)\r\n      const { html, error, redirected, resourceHints } = result\r\n\r\n      if (redirected) {\r\n        return html\r\n      }\r\n      if (error) {\r\n        res.statusCode = context.nuxt.error.statusCode || 500\r\n      }\r\n\r\n      // Add ETag header\r\n      if (!error && this.options.render.etag) {\r\n        const etag = generateETag(html, this.options.render.etag)\r\n        if (fresh(req.headers, { etag })) {\r\n          res.statusCode = 304\r\n          res.end()\r\n          return\r\n        }\r\n        res.setHeader('ETag', etag)\r\n      }\r\n\r\n      // HTTP2 push headers\r\n      if (!error && this.options.render.http2.push) {\r\n        // Parse resourceHints to extract HTTP.2 prefetch/push headers\r\n        // https://w3c.github.io/preload/#server-push-http-2\r\n        const regex = /link rel=\"([^\"]*)\" href=\"([^\"]*)\" as=\"([^\"]*)\"/g\r\n        const pushAssets = []\r\n        let m\r\n        while (m = regex.exec(resourceHints)) { // eslint-disable-line no-cond-assign\r\n          const [_, rel, href, as] = m // eslint-disable-line no-unused-vars\r\n          if (rel === 'preload') {\r\n            pushAssets.push(`<${href}>; rel=${rel}; as=${as}`)\r\n          }\r\n        }\r\n        // Pass with single Link header\r\n        // https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header\r\n        res.setHeader('Link', pushAssets.join(','))\r\n      }\r\n\r\n      // Send response\r\n      res.setHeader('Content-Type', 'text/html; charset=utf-8')\r\n      res.setHeader('Content-Length', Buffer.byteLength(html))\r\n      res.end(html, 'utf8')\r\n      return html\r\n    } catch (err) {\r\n      /* istanbul ignore if */\r\n      if (context && context.redirected) {\r\n        console.error(err) // eslint-disable-line no-console\r\n        return err\r\n      }\r\n\r\n      next(err)\r\n    }\r\n  }\r\n\r\n  errorMiddleware(err, req, res, next) {\r\n    // ensure statusCode, message and name fields\r\n    err.statusCode = err.statusCode || 500\r\n    err.message = err.message || 'Nuxt Server Error'\r\n    err.name = (!err.name || err.name === 'Error') ? 'NuxtServerError' : err.name\r\n\r\n    // We hide actual errors from end users, so show them on server logs\r\n    if (err.statusCode !== 404) {\r\n      console.error(err) // eslint-disable-line no-console\r\n    }\r\n\r\n    const sendResponse = (content, type = 'text/html') => {\r\n      // Set Headers\r\n      res.statusCode = err.statusCode\r\n      res.statusMessage = err.name\r\n      res.setHeader('Content-Type', type + '; charset=utf-8')\r\n      res.setHeader('Content-Length', Buffer.byteLength(content))\r\n\r\n      // Send Response\r\n      res.end(content, 'utf-8')\r\n    }\r\n\r\n    // Check if request accepts JSON\r\n    const hasReqHeader = (header, includes) => req.headers[header] && req.headers[header].toLowerCase().includes(includes)\r\n    const isJson = hasReqHeader('accept', 'application/json') || hasReqHeader('user-agent', 'curl/')\r\n\r\n    // Use basic errors when debug mode is disabled\r\n    if (!this.options.debug) {\r\n      // Json format is compatible with Youch json responses\r\n      const json = {\r\n        status: err.statusCode,\r\n        message: err.message,\r\n        name: err.name\r\n      }\r\n      if (isJson) {\r\n        sendResponse(JSON.stringify(json, undefined, 2), 'text/json')\r\n        return\r\n      }\r\n      const html = this.resources.errorTemplate(json)\r\n      sendResponse(html)\r\n      return\r\n    }\r\n\r\n    // Show stack trace\r\n    const youch = new Youch(err, req, this.readSource.bind(this))\r\n    if (isJson) {\r\n      youch.toJSON().then(json => { sendResponse(JSON.stringify(json, undefined, 2), 'text/json') })\r\n    } else {\r\n      youch.toHTML().then(html => { sendResponse(html) })\r\n    }\r\n  }\r\n\r\n  async readSource(frame) {\r\n    const serverBundle = this.resources.serverBundle\r\n\r\n    // Remove webpack:/// & query string from the end\r\n    const sanitizeName = name => name ? name.replace('webpack:///', '').split('?')[0] : ''\r\n\r\n    // SourceMap Support for SSR Bundle\r\n    if (serverBundle && serverBundle.maps[frame.fileName]) {\r\n      // Initialize smc cache\r\n      if (!serverBundle.$maps) {\r\n        serverBundle.$maps = {}\r\n      }\r\n\r\n      // Read SourceMap object\r\n      const smc = serverBundle.$maps[frame.fileName] || new SourceMapConsumer(serverBundle.maps[frame.fileName])\r\n      serverBundle.$maps[frame.fileName] = smc\r\n\r\n      // Try to find original position\r\n      const { line, column, name, source } = smc.originalPositionFor({\r\n        line: frame.getLineNumber() || 0,\r\n        column: frame.getColumnNumber() || 0,\r\n        bias: SourceMapConsumer.LEAST_UPPER_BOUND\r\n      })\r\n      if (line) {\r\n        frame.lineNumber = line\r\n      }\r\n      if (column) {\r\n        frame.columnNumber = column\r\n      }\r\n      if (name) {\r\n        frame.functionName = name\r\n      }\r\n      if (source) {\r\n        frame.fileName = sanitizeName(source)\r\n\r\n        // Source detected, try to get original source code\r\n        const contents = smc.sourceContentFor(source)\r\n        if (contents) {\r\n          frame.contents = contents\r\n        }\r\n      }\r\n    }\r\n\r\n    // Return if fileName is still unknown\r\n    if (!frame.fileName) {\r\n      return\r\n    }\r\n\r\n    frame.fileName = sanitizeName(frame.fileName)\r\n\r\n    // Try to read from SSR bundle files\r\n    if (serverBundle && serverBundle.files[frame.fileName]) {\r\n      frame.contents = serverBundle.files[frame.fileName]\r\n      return\r\n    }\r\n\r\n    // Possible paths for file\r\n    const searchPath = [\r\n      this.options.rootDir,\r\n      join(this.options.buildDir, 'dist'),\r\n      this.options.srcDir,\r\n      this.options.buildDir\r\n    ]\r\n\r\n    // Scan filesystem for real path\r\n    for (let pathDir of searchPath) {\r\n      let fullPath = resolve(pathDir, frame.fileName)\r\n      let source = await fs.readFile(fullPath, 'utf-8').catch(() => null)\r\n      if (source) {\r\n        if (!frame.contents) {\r\n          frame.contents = source\r\n        }\r\n        frame.fullPath = fullPath\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  async renderRoute(url, context = {}) {\r\n    /* istanbul ignore if */\r\n    if (!this.isReady) {\r\n      return new Promise(resolve => {\r\n        setTimeout(() => resolve(this.renderRoute(url, context)), 1000)\r\n      })\r\n    }\r\n\r\n    // Log rendered url\r\n    debug(`Rendering url ${url}`)\r\n\r\n    // Add url and isSever to the context\r\n    context.url = url\r\n\r\n    // Basic response if SSR is disabled or spa data provided\r\n    const spa = context.spa || (context.res && context.res.spa)\r\n    const ENV = this.options.env\r\n\r\n    if (this.noSSR || spa) {\r\n      const { HTML_ATTRS, BODY_ATTRS, HEAD, BODY_SCRIPTS, resourceHints } = await this.metaRenderer.render(context)\r\n      const APP = `<div id=\"__nuxt\">${this.resources.loadingHTML}</div>` + BODY_SCRIPTS\r\n\r\n      // Detect 404 errors\r\n      if (url.includes(this.options.build.publicPath) || url.includes('__webpack')) {\r\n        const err = { statusCode: 404, message: this.options.messages.error_404, name: 'ResourceNotFound' }\r\n        throw err\r\n      }\r\n\r\n      const html = this.resources.spaTemplate({\r\n        HTML_ATTRS,\r\n        BODY_ATTRS,\r\n        HEAD,\r\n        APP,\r\n        ENV\r\n      })\r\n\r\n      return { html, resourceHints }\r\n    }\r\n\r\n    // Call renderToString from the bundleRenderer and generate the HTML (will update the context as well)\r\n    let APP = await this.bundleRenderer.renderToString(context)\r\n\r\n    if (!context.nuxt.serverRendered) {\r\n      APP = '<div id=\"__nuxt\"></div>'\r\n    }\r\n    const m = context.meta.inject()\r\n    let HEAD = m.meta.text() + m.title.text() + m.link.text() + m.style.text() + m.script.text() + m.noscript.text()\r\n    if (this.options._routerBaseSpecified) {\r\n      HEAD += `<base href=\"${this.options.router.base}\">`\r\n    }\r\n\r\n    let resourceHints = ''\r\n\r\n    if (this.options.render.resourceHints) {\r\n      resourceHints = context.renderResourceHints()\r\n      HEAD += resourceHints\r\n    }\r\n    APP += `<script type=\"text/javascript\">window.__NUXT__=${serialize(context.nuxt, { isJSON: true })};</script>`\r\n    APP += context.renderScripts()\r\n    APP += m.script.text({ body: true })\r\n\r\n    HEAD += context.renderStyles()\r\n\r\n    let html = this.resources.ssrTemplate({\r\n      HTML_ATTRS: 'data-n-head-ssr ' + m.htmlAttrs.text(),\r\n      BODY_ATTRS: m.bodyAttrs.text(),\r\n      HEAD,\r\n      APP,\r\n      ENV\r\n    })\r\n\r\n    return {\r\n      html,\r\n      resourceHints,\r\n      error: context.nuxt.error,\r\n      redirected: context.redirected\r\n    }\r\n  }\r\n\r\n  async renderAndGetWindow(url, opts = {}) {\r\n    /* istanbul ignore if */\r\n    if (!jsdom) {\r\n      try {\r\n        jsdom = require('jsdom')\r\n      } catch (e) /* istanbul ignore next */ {\r\n        console.error('Fail when calling nuxt.renderAndGetWindow(url)') // eslint-disable-line no-console\r\n        console.error('jsdom module is not installed') // eslint-disable-line no-console\r\n        console.error('Please install jsdom with: npm install --save-dev jsdom') // eslint-disable-line no-console\r\n        throw e\r\n      }\r\n    }\r\n    let options = {\r\n      resources: 'usable', // load subresources (https://github.com/tmpvar/jsdom#loading-subresources)\r\n      runScripts: 'dangerously',\r\n      beforeParse(window) {\r\n        // Mock window.scrollTo\r\n        window.scrollTo = () => {}\r\n      }\r\n    }\r\n    if (opts.virtualConsole !== false) {\r\n      options.virtualConsole = new jsdom.VirtualConsole().sendTo(console)\r\n    }\r\n    url = url || 'http://localhost:3000'\r\n    const { window } = await jsdom.JSDOM.fromURL(url, options)\r\n    // If Nuxt could not be loaded (error from the server-side)\r\n    const nuxtExists = window.document.body.innerHTML.includes(this.options.render.ssr ? 'window.__NUXT__' : '<div id=\"__nuxt\">')\r\n    /* istanbul ignore if */\r\n    if (!nuxtExists) {\r\n      let error = new Error('Could not load the nuxt app')\r\n      error.body = window.document.body.innerHTML\r\n      throw error\r\n    }\r\n    // Used by nuxt.js to say when the components are loaded and the app ready\r\n    await new Promise((resolve) => {\r\n      window._onNuxtLoaded = () => resolve(window)\r\n    })\r\n    // Send back window object\r\n    return window\r\n  }\r\n}\r\n\r\nconst parseTemplate = templateStr => _.template(templateStr, {\r\n  interpolate: /{{([\\s\\S]+?)}}/g\r\n})\r\n\r\nconst resourceMap = [\r\n  {\r\n    key: 'clientManifest',\r\n    fileName: 'vue-ssr-client-manifest.json',\r\n    transform: JSON.parse\r\n  },\r\n  {\r\n    key: 'serverBundle',\r\n    fileName: 'server-bundle.json',\r\n    transform: JSON.parse\r\n  },\r\n  {\r\n    key: 'ssrTemplate',\r\n    fileName: 'index.ssr.html',\r\n    transform: parseTemplate\r\n  },\r\n  {\r\n    key: 'spaTemplate',\r\n    fileName: 'index.spa.html',\r\n    transform: parseTemplate\r\n  }\r\n]\r\n\r\n// Protector utility against request to SSR bundle files\r\nconst ssrResourceRegex = new RegExp(resourceMap.map(resource => resource.fileName).join('|'), 'i')\r\n","import chalk from 'chalk'\r\nimport { Options } from 'common'\r\nimport { sequence } from 'utils'\r\nimport ModuleContainer from './module'\r\nimport Renderer from './renderer'\r\nimport Debug from 'debug'\r\nimport enableDestroy from 'server-destroy'\r\nimport Module from 'module'\r\nimport { isPlainObject } from 'lodash'\r\nimport { join, resolve } from 'path'\r\n\r\nconst debug = Debug('nuxt:')\r\ndebug.color = 5\r\n\r\nexport default class Nuxt {\r\n  constructor(options = {}) {\r\n    this.options = Options.from(options)\r\n\r\n    // Paths for resolving requires from `rootDir`\r\n    this.nodeModulePaths = Module._nodeModulePaths(this.options.rootDir)\r\n\r\n    this.initialized = false\r\n    this.errorHandler = this.errorHandler.bind(this)\r\n    // Hooks\r\n    this._hooks = {}\r\n    this.hook = this.hook.bind(this)\r\n\r\n    // Create instance of core components\r\n    this.moduleContainer = new ModuleContainer(this)\r\n    this.renderer = new Renderer(this)\r\n\r\n    // Backward compatibility\r\n    this.render = this.renderer.app\r\n    this.renderRoute = this.renderer.renderRoute.bind(this.renderer)\r\n    this.renderAndGetWindow = this.renderer.renderAndGetWindow.bind(this.renderer)\r\n\r\n    this._ready = this.ready().catch(this.errorHandler)\r\n  }\r\n\r\n  async ready() {\r\n    if (this._ready) {\r\n      return this._ready\r\n    }\r\n\r\n    // Add hooks\r\n    if (isPlainObject(this.options.hooks)) {\r\n      this.addObjectHooks(this.options.hooks)\r\n    } else if (typeof this.options.hooks === 'function') {\r\n      this.options.hooks(this.hook)\r\n    }\r\n    // Add nuxt modules\r\n    await this.moduleContainer.ready()\r\n    await this.renderer.ready()\r\n\r\n    this.initialized = true\r\n    await this.callHook('ready', this)\r\n\r\n    return this\r\n  }\r\n\r\n  plugin(name, fn) {\r\n    // eslint-disable-next-line no-console\r\n    console.error(`[warn] nuxt.plugin('${name}',..) is deprecated. Please use new hooks system.`)\r\n\r\n    // A tiny backward compatibility util\r\n    const hookMap = {\r\n      'ready': 'ready',\r\n      'close': 'close',\r\n      'listen': 'listen',\r\n      'built': 'build:done'\r\n    }\r\n\r\n    if (hookMap[name]) {\r\n      this.hook(hookMap[name], fn)\r\n    }\r\n\r\n    // Always return nuxt class which has plugin() for two level hooks\r\n    return this\r\n  }\r\n\r\n  hook(name, fn) {\r\n    if (!name || typeof fn !== 'function') {\r\n      return\r\n    }\r\n    this._hooks[name] = this._hooks[name] || []\r\n    this._hooks[name].push(fn)\r\n  }\r\n\r\n  async callHook(name, ...args) {\r\n    if (!this._hooks[name]) {\r\n      return\r\n    }\r\n    debug(`Call ${name} hooks (${this._hooks[name].length})`)\r\n    try {\r\n      await sequence(this._hooks[name], (fn) => fn(...args))\r\n    } catch (err) {\r\n      console.error(`> Error on hook \"${name}\":`) // eslint-disable-line no-console\r\n      console.error(err) // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  addObjectHooks(hooksObj) {\r\n    Object.keys(hooksObj).forEach((name) => {\r\n      let hooks = hooksObj[name]\r\n      hooks = (Array.isArray(hooks) ? hooks : [hooks])\r\n\r\n      hooks.forEach((hook) => {\r\n        this.hook(name, hook)\r\n      })\r\n    })\r\n  }\r\n\r\n  listen(port = 3000, host = 'localhost') {\r\n    return new Promise((resolve, reject) => {\r\n      const server = this.renderer.app.listen({ port, host, exclusive: false }, (err) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n\r\n        const _host = host === '0.0.0.0' ? 'localhost' : host\r\n        // eslint-disable-next-line no-console\r\n        console.log('\\n' + chalk.bgGreen.black(' OPEN ') + chalk.green(` http://${_host}:${port}\\n`))\r\n\r\n        // Close server on nuxt close\r\n        this.hook('close', () => new Promise((resolve, reject) => {\r\n          // Destroy server by forcing every connection to be closed\r\n          server.destroy(err => {\r\n            debug('server closed')\r\n            /* istanbul ignore if */\r\n            if (err) {\r\n              return reject(err)\r\n            }\r\n            resolve()\r\n          })\r\n        }))\r\n\r\n        this.callHook('listen', server, { port, host }).then(resolve)\r\n      })\r\n\r\n      // Add server.destroy(cb) method\r\n      enableDestroy(server)\r\n    })\r\n  }\r\n\r\n  errorHandler/* istanbul ignore next */() {\r\n    // Apply plugins\r\n    // eslint-disable-next-line no-console\r\n    this.callHook('error', ...arguments).catch(console.error)\r\n\r\n    // Silent\r\n    if (this.options.errorHandler === false) {\r\n      return\r\n    }\r\n\r\n    // Custom errorHandler\r\n    if (typeof this.options.errorHandler === 'function') {\r\n      return this.options.errorHandler.apply(this, arguments)\r\n    }\r\n\r\n    // Default handler\r\n    // eslint-disable-next-line no-console\r\n    console.error(...arguments)\r\n  }\r\n\r\n  resolvePath(path) {\r\n    // Try to resolve using NPM resolve path first\r\n    try {\r\n      let resolvedPath = Module._resolveFilename(path, { paths: this.nodeModulePaths })\r\n      return resolvedPath\r\n    } catch (e) {\r\n      // Just continue\r\n    }\r\n    // Shorthand to resolve from project dirs\r\n    if (path.indexOf('@@') === 0 || path.indexOf('~~') === 0) {\r\n      return join(this.options.rootDir, path.substr(2))\r\n    } else if (path.indexOf('@') === 0 || path.indexOf('~') === 0) {\r\n      return join(this.options.srcDir, path.substr(1))\r\n    }\r\n    return resolve(this.options.srcDir, path)\r\n  }\r\n\r\n  async close(callback) {\r\n    await this.callHook('close', this)\r\n\r\n    /* istanbul ignore if */\r\n    if (typeof callback === 'function') {\r\n      await callback()\r\n    }\r\n  }\r\n}\r\n"],"names":["encodeHtml","str","replace","getContext","req","res","setAnsiColors","ansiHTML","setColors","ms","Promise","resolve","waitFor","urlJoin","slice","call","arguments","join","isUrl","url","indexOf","promisifyRoute","fn","Array","isArray","length","reject","err","routeParams","promise","then","sequence","tasks","reduce","task","parallel","all","map","chainFn","base","Function","apply","baseResult","undefined","fnResult","prototype","isPureObject","o","isWindows","test","process","platform","wp","p","wChunk","reqSep","sysSep","_","escapeRegExp","sep","normalize","string","r","args","lastArg","last","includes","relativeTo","dir","shift","path","rp","relative","flatRoutes","router","routes","forEach","children","push","cleanChildrenRoutes","isChild","start","routesIndex","route","name","split","s","names","paths","i","a","find","child","createRoutes","files","srcDir","file","keys","component","parent","key","chunkName","sort","b","y","z","_a","_b","debug","Debug","color","Options","from","_options","options","Object","assign","loading","middleware","_routerBaseSpecified","transition","layoutTransition","defaultsDeep","defaults","hasValue","v","rootDir","cwd","modulesDir","buildDir","cacheDir","appTemplatePath","existsSync","dev","build","publicPath","store","loadingIndicator","cssSourceMap","postcss","postcssConfigPath","plugins","modePreset","modes","mode","render","ssr","appear","env","NODE_ENV","__dirname","ModuleContainer","nuxt","requiredModules","callHook","modules","addModule","bind","vendor","uniq","concat","template","src","srcPath","parse","fs","dst","fileName","basename","hash","ext","templateObj","templates","addTemplate","unshift","serverMiddleware","extend","extendRoutes","moduleOpts","requireOnce","module","require","resolvePath","Error","JSON","stringify","meta","alreadyRequired","result","MetaRenderer","renderer","vueRenderer","VueServerRenderer","createRenderer","cache","LRU","use","VueMeta","vm","Vue","h","head","renderToString","$meta","inject","get","m","getMeta","HTML_ATTRS","htmlAttrs","text","BODY_ATTRS","bodyAttrs","HEAD","title","link","style","script","noscript","BODY_SCRIPTS","body","resourceHints","clientManifest","resources","initial","async","set","jsdom","Renderer","bundleRenderer","metaRenderer","webpackDevMiddleware","webpackHotMiddleware","app","connect","parseTemplate","setupMiddleware","loadResources","_fs","distPath","updated","transform","rawKey","rawData","data","readFileSync","errorTemplatePath","errorTemplate","loadingHTMLPath","loadingHTML","noSSR","isReady","Boolean","spaTemplate","ssrTemplate","isResourcesAvailable","serverBundle","createBundleRenderer","$m","handler","prefix","$src","gzip","useMiddleware","compression","next","ssrResourceRegex","statusCode","end","_this","openInEditor","editor","configure","query","q","part","decodeURIComponent","log","open","catch","serveStatic","static","distDir","nuxtMiddleware","errorMiddleware","context","renderRoute","html","error","redirected","etag","generateETag","fresh","headers","setHeader","http2","regex","pushAssets","exec","rel","href","as","Buffer","byteLength","message","sendResponse","content","type","statusMessage","hasReqHeader","header","toLowerCase","isJson","json","youch","Youch","readSource","toJSON","toHTML","frame","sanitizeName","maps","$maps","smc","SourceMapConsumer","line","column","source","originalPositionFor","getLineNumber","getColumnNumber","LEAST_UPPER_BOUND","lineNumber","columnNumber","functionName","contents","sourceContentFor","searchPath","pathDir","fullPath","readFile","spa","ENV","APP","messages","error_404","serverRendered","renderResourceHints","serialize","isJSON","renderScripts","renderStyles","opts","e","window","scrollTo","virtualConsole","VirtualConsole","sendTo","console","JSDOM","fromURL","nuxtExists","document","innerHTML","_onNuxtLoaded","templateStr","resourceMap","RegExp","resource","Nuxt","nodeModulePaths","Module","_nodeModulePaths","initialized","errorHandler","_hooks","hook","moduleContainer","renderAndGetWindow","_ready","ready","isPlainObject","hooks","addObjectHooks","hookMap","hooksObj","port","host","server","listen","exclusive","_host","chalk","bgGreen","black","green","destroy","resolvedPath","_resolveFilename","substr","callback"],"mappings":"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"}